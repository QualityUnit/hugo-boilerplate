{{/* Language Selector Partial */}}
{{ $hasMultipleLanguages := gt (len site.Home.AllTranslations) 1 }}

{{ if $hasMultipleLanguages }}
<div class="language-selector">
  <div class="flex flex-wrap items-center justify-center gap-3">
    {{ if .Translations }}
      {{ $currentPage := . }}
      {{ range .Translations }}
        {{ $langCode := .Language.Lang }}
        
        {{ $bcp47Lang := "" }}
        {{ if eq $langCode "en" }}
          {{ $bcp47Lang = "en-us" }}
        {{ else }}
          {{ $bcp47Lang = $langCode }}
        {{ end }}
        
        <a href="{{ .Permalink }}" 
           class="inline-flex items-center" 
           title="{{ .Language.LanguageName }} - {{ .Site.BaseURL | replaceRE "https?://" "" }}">
          <img src="{{ (printf "flags/%s.png" $bcp47Lang) | relURL }}" 
               alt="{{ .Language.LanguageName }} - {{ .Site.BaseURL | replaceRE "https?://" "" }}" 
               class="w-6 h-4 hover:opacity-75 transition-opacity">
        </a>
      {{ end }}
    {{ else }}
      <!-- Fallback to all translations if page translations aren't available -->
      {{ with site.Home.AllTranslations }}
        {{ range . }}
          {{ $isCurrentLang := eq $.Site.Language.Lang .Language.Lang }}
          {{ if not $isCurrentLang }}
            {{ $langCode := .Language.Lang }}
            
            {{ $bcp47Lang := "" }}
            {{ if eq $langCode "en" }}
              {{ $bcp47Lang = "en-us" }}
            {{ else }}
              {{ $bcp47Lang = $langCode }}
            {{ end }}
            
            <a href="{{ .Permalink }}" 
               class="inline-flex items-center" 
               title="{{ .Language.LanguageName }} - {{ .Site.BaseURL | replaceRE "https?://" "" }}">
              <img src="{{ (printf "flags/%s.png" $bcp47Lang) | relURL }}" 
                   alt="{{ .Language.LanguageName }} - {{ .Site.BaseURL | replaceRE "https?://" "" }}" 
                   class="w-6 h-4 hover:opacity-75 transition-opacity">
            </a>
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
  </div>
</div>
{{ end }}

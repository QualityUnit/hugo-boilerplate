{{/*
@partial: Schema.org Article/BlogPosting
@description: Generates JSON-LD structured data for blog posts and articles
@params:
  - page: Page context (required)
  - articleType: Type of article - "BlogPosting", "Article", "NewsArticle", "TechArticle" (optional, defaults to BlogPosting)
@example:
  {{ partial "schemaorg/article.html" . }}
  {{ partial "schemaorg/article.html" (dict "page" . "articleType" "TechArticle") }}
@note: Automatically uses page metadata (title, description, date, author, etc.)
*/}}

{{/* Handle both direct page context and dict with page key */}}
{{ $page := . }}
{{ if reflect.IsMap . }}
  {{ if isset . "page" }}
    {{ $page = .page }}
  {{ end }}
{{ end }}
{{ $site := $page.Site }}

{{/* Get article type */}}
{{ $articleType := "BlogPosting" }}
{{ if reflect.IsMap . }}
  {{ $articleType = .articleType | default "BlogPosting" }}
{{ end }}

{{/* Get author information */}}
{{ $authorName := "Anonymous" }}
{{ $authorImage := "" }}
{{ if $page.Params.author }}
  {{ $authorKey := $page.Params.author }}
  {{ $authors := $site.Data.authors }}
  {{ if and $authors (index $authors $authorKey) }}
    {{ $author := index $authors $authorKey }}
    {{ $authorName = $author.name }}
    {{ $authorImage = $author.image }}
  {{ end }}
{{ end }}

{{/* Get article image */}}
{{ $image := "" }}
{{ with $page.Params.image }}
  {{ $image = (printf "%s%s" $site.BaseURL (strings.TrimPrefix "/" .)) }}
{{ else with $page.Params.featured_image }}
  {{ $image = (printf "%s%s" $site.BaseURL (strings.TrimPrefix "/" .)) }}
{{ else with $site.Params.defaultImage }}
  {{ $image = (printf "%s%s" $site.BaseURL (strings.TrimPrefix "/" .)) }}
{{ end }}

{{- $authorObj := dict "@type" "Person" "name" $authorName -}}
{{- with $authorImage }}{{ $authorObj = merge $authorObj (dict "image" .) }}{{ end -}}

{{- $publisher := dict "@type" "Organization" "name" $site.Title "url" $site.BaseURL -}}
{{- with $site.Params.organization.logo -}}
  {{- $logo := dict "@type" "ImageObject" "url" (printf "%s%s" $site.BaseURL (strings.TrimPrefix "/" .)) -}}
  {{- $publisher = merge $publisher (dict "logo" $logo) -}}
{{- end -}}

{{- $mainEntity := dict "@type" "WebPage" "@id" $page.Permalink -}}

{{- $schema := dict "@context" "https://schema.org" "@type" $articleType "headline" $page.Title "datePublished" ($page.Date.Format "2006-01-02T15:04:05Z07:00") "dateModified" ($page.Lastmod.Format "2006-01-02T15:04:05Z07:00") "author" $authorObj "publisher" $publisher "mainEntityOfPage" $mainEntity "url" $page.Permalink "articleBody" $page.Plain "inLanguage" $page.Language.Lang -}}
{{- with $page.Description }}{{ $schema = merge $schema (dict "description" .) }}{{ end -}}
{{- with $image }}{{ $schema = merge $schema (dict "image" .) }}{{ end -}}
{{- with $page.Params.tags }}{{ $schema = merge $schema (dict "keywords" (delimit . ", ")) }}{{ end -}}
{{- with $page.WordCount }}{{ $schema = merge $schema (dict "wordCount" .) }}{{ end -}}
{{- with $page.Params.category }}{{ $schema = merge $schema (dict "articleSection" .) }}{{ end -}}
{{- with $page.Params.timeToRead }}{{ $schema = merge $schema (dict "timeRequired" (printf "PT%dM" .)) }}{{ end -}}
<script type="application/ld+json">
{{- $schema | jsonify | safeJS -}}
</script>
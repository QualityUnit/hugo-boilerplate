{{/*
@partial: Schema.org Discussion Forum Posting
@description: Generates JSON-LD structured data for Reddit-style discussion pages
              using schema.org DiscussionForumPosting type for better AI discoverability.
@params:
  - page: The page context (required)
@example:
  {{ partial "schemaorg/discussion.html" . }}
@note: Generates DiscussionForumPosting structured data optimized for AI citation
*/}}

{{ $page := . }}
{{ $site := $page.Site }}

{{/* Get discussion metadata from frontmatter */}}
{{ $username := "" }}
{{ $role := "" }}
{{ $verified := false }}
{{ with $page.Params.op }}
  {{ $username = .username | default "Community Member" }}
  {{ $role = .role | default "" }}
  {{ $verified = .verified | default false }}
{{ end }}

{{ $upvotes := $page.Params.upvotes | default 0 }}
{{ $commentCount := $page.Params.commentCount | default 0 }}

<!-- Schema.org structured data for discussion forum posting -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "DiscussionForumPosting",
  "@id": {{ $page.Permalink | jsonify }},
  "headline": {{ $page.Title | jsonify }},
  "text": {{ $page.Description | default $page.Summary | plainify | jsonify }},
  "url": {{ $page.Permalink | jsonify }},
  "datePublished": {{ $page.Date.Format "2006-01-02T15:04:05Z07:00" | jsonify }},
  "dateModified": {{ $page.Lastmod.Format "2006-01-02T15:04:05Z07:00" | jsonify }},
  "author": {
    "@type": "Person",
    "name": {{ $username | jsonify }}
    {{ if $role }},
    "jobTitle": {{ $role | jsonify }}
    {{ end }}
  },
  "interactionStatistic": [
    {
      "@type": "InteractionCounter",
      "interactionType": "https://schema.org/LikeAction",
      "userInteractionCount": {{ $upvotes }}
    },
    {
      "@type": "InteractionCounter",
      "interactionType": "https://schema.org/CommentAction",
      "userInteractionCount": {{ $commentCount }}
    }
  ],
  "discussionUrl": {{ $page.Permalink | jsonify }},
  "isPartOf": {
    "@type": "DiscussionForum",
    "name": {{ printf "%s Community Discussions" $site.Title | jsonify }},
    "url": {{ printf "%sdiscussion/" $site.BaseURL | jsonify }},
    "description": "Community discussions about AI visibility, brand monitoring, and content strategy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": {{ $page.Permalink | jsonify }}
  },
  "publisher": {
    "@type": "Organization",
    "name": {{ $site.Title | jsonify }},
    "url": {{ $site.BaseURL | jsonify }},
    "logo": {
      "@type": "ImageObject",
      "url": {{ printf "%simages/logo.png" $site.BaseURL | jsonify }}
    }
  }
  {{ if $page.Params.tags }},
  "keywords": {{ $page.Params.tags | jsonify }}
  {{ end }}
  {{ if $page.Params.image }},
  "image": {{ printf "%s%s" $site.BaseURL (strings.TrimPrefix "/" $page.Params.image) | jsonify }}
  {{ end }}
}
</script>

{{/* Also add FAQPage schema if there are FAQ items */}}
{{ if $page.Params.faq }}
{{ partial "schemaorg/faq.html" (dict "faq" $page.Params.faq) }}
{{ end }}

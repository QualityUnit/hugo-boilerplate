{{/*
@partial: Schema.org JobPosting
@description: Generates JSON-LD structured data for job postings
@params:
  - title: Job title (required)
  - description: Job description (required)
  - datePosted: Date posted in ISO 8601 format (required)
  - validThrough: Application deadline
  - employmentType: "FULL_TIME", "PART_TIME", "CONTRACT", "TEMPORARY", "INTERN"
  - location: Job location (city, state, country or "Remote")
  - baseSalary: Salary information
  - hiringOrganization: Company name (defaults to site title)
@example:
  {{ partial "schemaorg/jobposting.html" (dict
      "title" "Senior Software Engineer"
      "description" "We are looking for an experienced software engineer..."
      "datePosted" "2026-01-20"
      "validThrough" "2026-03-20"
      "employmentType" "FULL_TIME"
      "location" (dict "city" "San Francisco" "state" "CA" "country" "US")
      "baseSalary" (dict "currency" "USD" "value" 120000 "unitText" "YEAR")
    ) }}
@note: Enables Google Jobs integration and job search visibility
*/}}

{{ $site := .Site }}
{{ $title := .title }}
{{ $description := .description }}
{{ $datePosted := .datePosted }}

{{ if and $title $description $datePosted }}
{{- $hiringOrg := dict "@type" "Organization" "name" (.hiringOrganization | default $site.Title) "url" $site.BaseURL -}}
{{- with $site.Params.organization.logo -}}
  {{- $logo := dict "@type" "ImageObject" "url" (printf "%s%s" $site.BaseURL (strings.TrimPrefix "/" .)) -}}
  {{- $hiringOrg = merge $hiringOrg (dict "logo" $logo) -}}
{{- end -}}

{{- $schema := dict "@context" "https://schema.org" "@type" "JobPosting" "title" $title "description" $description "datePosted" $datePosted "hiringOrganization" $hiringOrg "url" (.url | default $site.BaseURL) -}}
{{- with .validThrough }}{{ $schema = merge $schema (dict "validThrough" .) }}{{ end -}}
{{- with .employmentType }}{{ $schema = merge $schema (dict "employmentType" .) }}{{ end -}}

{{- $location := .location -}}
{{- if $location -}}
  {{- if eq $location "Remote" -}}
    {{- $schema = merge $schema (dict "jobLocationType" "TELECOMMUTE" "applicantLocationRequirements" (dict "@type" "Country" "name" "Worldwide")) -}}
  {{- else -}}
    {{- $addr := dict "@type" "PostalAddress" -}}
    {{- with $location.streetAddress }}{{ $addr = merge $addr (dict "streetAddress" .) }}{{ end -}}
    {{- with $location.city }}{{ $addr = merge $addr (dict "addressLocality" .) }}{{ end -}}
    {{- with $location.state }}{{ $addr = merge $addr (dict "addressRegion" .) }}{{ end -}}
    {{- with $location.postalCode }}{{ $addr = merge $addr (dict "postalCode" .) }}{{ end -}}
    {{- with $location.country }}{{ $addr = merge $addr (dict "addressCountry" .) }}{{ end -}}
    {{- $schema = merge $schema (dict "jobLocation" (dict "@type" "Place" "address" $addr)) -}}
  {{- end -}}
{{- end -}}

{{- with .baseSalary -}}
  {{- $value := dict "@type" "QuantitativeValue" "value" .value "unitText" .unitText -}}
  {{- $salary := dict "@type" "MonetaryAmount" "currency" .currency "value" $value -}}
  {{- $schema = merge $schema (dict "baseSalary" $salary) -}}
{{- end -}}
{{- with .responsibilities }}{{ $schema = merge $schema (dict "responsibilities" .) }}{{ end -}}
{{- with .skills }}{{ $schema = merge $schema (dict "skills" .) }}{{ end -}}
{{- with .qualifications }}{{ $schema = merge $schema (dict "qualifications" .) }}{{ end -}}
{{- with .educationRequirements }}{{ $schema = merge $schema (dict "educationRequirements" .) }}{{ end -}}
{{- with .experienceRequirements }}{{ $schema = merge $schema (dict "experienceRequirements" .) }}{{ end -}}
{{- with .benefits }}{{ $schema = merge $schema (dict "jobBenefits" .) }}{{ end -}}
{{- with .workHours }}{{ $schema = merge $schema (dict "workHours" .) }}{{ end -}}
{{- with .industryCategories }}{{ $schema = merge $schema (dict "industry" .) }}{{ end -}}
{{- with .occupationalCategory }}{{ $schema = merge $schema (dict "occupationalCategory" .) }}{{ end -}}
<script type="application/ld+json">
{{- $schema | jsonify | safeJS -}}
</script>
{{ end }}
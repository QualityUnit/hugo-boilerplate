{{/*
@partial: Schema.org Service
@description: Generates JSON-LD structured data for service offerings
@params:
  - services: Array of service objects (optional, for multiple services)
  - service: Single service object (optional, for single service)
  Service object structure:
    - name: Service name
    - description: Service description
    - serviceType: Type of service
    - provider: Provider name (defaults to site title)
    - areaServed: Geographic area or "Worldwide"
    - audience: Target audience
    - offers: Pricing/offer details
@example:
  Single service:
    {{ partial "schemaorg/service.html" (dict "service" $service) }}

  Multiple services:
    {{ partial "schemaorg/service.html" (dict "services" $services) }}

  From frontmatter:
    {{ partial "schemaorg/service.html" . }}
@note: Critical for SaaS as services, not just products
*/}}

{{ $site := .Site }}
{{ $page := . }}

{{/* Handle single service */}}
{{ $service := .service }}
{{ if $service }}
{{- $provider := dict "@type" "Organization" "name" ($service.provider | default $site.Title) "url" $site.BaseURL -}}
{{- $schema := dict "@context" "https://schema.org" "@type" "Service" "name" $service.name "provider" $provider "url" ($service.url | default $site.BaseURL) -}}
{{- with $service.description }}{{ $schema = merge $schema (dict "description" .) }}{{ end -}}
{{- with $service.serviceType }}{{ $schema = merge $schema (dict "serviceType" .) }}{{ end -}}
{{- with $service.image -}}
  {{- $img := dict "@type" "ImageObject" "url" (printf "%s%s" $site.BaseURL (strings.TrimPrefix "/" .)) -}}
  {{- $schema = merge $schema (dict "image" $img) -}}
{{- end -}}
{{- with $service.areaServed }}{{ $schema = merge $schema (dict "areaServed" .) }}{{ else }}{{ $schema = merge $schema (dict "areaServed" "Worldwide") }}{{ end -}}
{{- with $service.audience -}}
  {{- $schema = merge $schema (dict "audience" (dict "@type" "Audience" "audienceType" .)) -}}
{{- end -}}
{{- with $service.category }}{{ $schema = merge $schema (dict "category" .) }}{{ end -}}
{{- with $service.offers -}}
  {{- $offer := dict "@type" "Offer" "availability" (.availability | default "https://schema.org/InStock") "url" ($service.url | default $site.BaseURL) -}}
  {{- with .price }}{{ $offer = merge $offer (dict "price" .) }}{{ end -}}
  {{- with .priceCurrency }}{{ $offer = merge $offer (dict "priceCurrency" .) }}{{ end -}}
  {{- with .description }}{{ $offer = merge $offer (dict "description" .) }}{{ end -}}
  {{- $schema = merge $schema (dict "offers" $offer) -}}
{{- end -}}
{{- with $service.termsOfService }}{{ $schema = merge $schema (dict "termsOfService" .) }}{{ end -}}
{{- with $service.serviceOutput }}{{ $schema = merge $schema (dict "serviceOutput" .) }}{{ end -}}
<script type="application/ld+json">
{{- $schema | jsonify | safeJS -}}
</script>
{{ end }}

{{/* Handle multiple services */}}
{{ $services := .services }}
{{ if $services }}
{{- $serviceArray := slice -}}
{{- range $services -}}
  {{- $provider := dict "@type" "Organization" "name" (.provider | default $site.Title) "url" $site.BaseURL -}}
  {{- $svc := dict "@context" "https://schema.org" "@type" "Service" "name" .name "provider" $provider "url" (.url | default $site.BaseURL) -}}
  {{- with .description }}{{ $svc = merge $svc (dict "description" .) }}{{ end -}}
  {{- with .serviceType }}{{ $svc = merge $svc (dict "serviceType" .) }}{{ end -}}
  {{- with .image -}}
    {{- $img := dict "@type" "ImageObject" "url" (printf "%s%s" $site.BaseURL (strings.TrimPrefix "/" .)) -}}
    {{- $svc = merge $svc (dict "image" $img) -}}
  {{- end -}}
  {{- with .areaServed }}{{ $svc = merge $svc (dict "areaServed" .) }}{{ else }}{{ $svc = merge $svc (dict "areaServed" "Worldwide") }}{{ end -}}
  {{- with .offers -}}
    {{- $offer := dict "@type" "Offer" "availability" (.availability | default "https://schema.org/InStock") "url" ($svc.url | default $site.BaseURL) -}}
    {{- with .price }}{{ $offer = merge $offer (dict "price" .) }}{{ end -}}
    {{- with .priceCurrency }}{{ $offer = merge $offer (dict "priceCurrency" .) }}{{ end -}}
    {{- $svc = merge $svc (dict "offers" $offer) -}}
  {{- end -}}
  {{- $serviceArray = $serviceArray | append $svc -}}
{{- end -}}
<script type="application/ld+json">
{{- $serviceArray | jsonify | safeJS -}}
</script>
{{ end }}
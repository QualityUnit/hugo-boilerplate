{{/*
@partial: Schema.org Event
@description: Generates JSON-LD structured data for events (webinars, conferences, online events)
@params:
  - name: Event name (required)
  - description: Event description (required)
  - startDate: Start date/time in ISO 8601 format (required)
  - endDate: End date/time in ISO 8601 format (optional)
  - eventAttendanceMode: "OnlineEventAttendanceMode", "OfflineEventAttendanceMode", "MixedEventAttendanceMode"
  - eventStatus: "EventScheduled", "EventCancelled", "EventPostponed", "EventRescheduled"
  - location: Location object (for physical) or URL (for online)
  - image: Event image URL
  - organizer: Organizer name (defaults to site title)
  - performer: Speaker/presenter information
  - offers: Ticket/registration offers
@example:
  Webinar:
    {{ partial "schemaorg/event.html" (dict
      "name" "SaaS Marketing Webinar"
      "description" "Learn how to grow your SaaS business"
      "startDate" "2026-02-15T14:00:00-05:00"
      "endDate" "2026-02-15T15:00:00-05:00"
      "eventAttendanceMode" "OnlineEventAttendanceMode"
      "location" "https://example.com/webinar"
      "image" "/images/webinar.jpg"
      "offers" (dict "price" "0" "priceCurrency" "USD" "url" "https://example.com/register")
    ) }}
@note: Critical for SaaS webinar marketing and event SEO
*/}}

{{ $site := .Site }}
{{ $name := .name }}
{{ $description := .description }}
{{ $startDate := .startDate }}

{{ if and $name $description $startDate }}
{{- $organizer := dict "@type" "Organization" "name" (.organizer | default $site.Title) "url" $site.BaseURL -}}

{{- $schema := dict "@context" "https://schema.org" "@type" (.eventType | default "Event") "name" $name "description" $description "startDate" $startDate "organizer" $organizer -}}
{{- with .endDate }}{{ $schema = merge $schema (dict "endDate" .) }}{{ end -}}
{{- with .eventAttendanceMode }}{{ $schema = merge $schema (dict "eventAttendanceMode" (printf "https://schema.org/%s" .)) }}{{ end -}}
{{- with .eventStatus -}}
  {{- $schema = merge $schema (dict "eventStatus" (printf "https://schema.org/%s" .)) -}}
{{- else -}}
  {{- $schema = merge $schema (dict "eventStatus" "https://schema.org/EventScheduled") -}}
{{- end -}}
{{- with .image -}}
  {{- $img := dict "@type" "ImageObject" "url" (printf "%s%s" $site.BaseURL (strings.TrimPrefix "/" .)) -}}
  {{- $schema = merge $schema (dict "image" $img) -}}
{{- end -}}

{{- $location := .location -}}
{{- if $location -}}
  {{- if or (hasPrefix $location "http://") (hasPrefix $location "https://") -}}
    {{- $schema = merge $schema (dict "location" (dict "@type" "VirtualLocation" "url" $location)) -}}
  {{- else -}}
    {{- $place := dict "@type" "Place" "name" $location -}}
    {{- with .address -}}
      {{- $addr := dict "@type" "PostalAddress" -}}
      {{- with .streetAddress }}{{ $addr = merge $addr (dict "streetAddress" .) }}{{ end -}}
      {{- with .addressLocality }}{{ $addr = merge $addr (dict "addressLocality" .) }}{{ end -}}
      {{- with .addressRegion }}{{ $addr = merge $addr (dict "addressRegion" .) }}{{ end -}}
      {{- with .postalCode }}{{ $addr = merge $addr (dict "postalCode" .) }}{{ end -}}
      {{- with .addressCountry }}{{ $addr = merge $addr (dict "addressCountry" .) }}{{ end -}}
      {{- $place = merge $place (dict "address" $addr) -}}
    {{- end -}}
    {{- $schema = merge $schema (dict "location" $place) -}}
  {{- end -}}
{{- end -}}

{{- with .performer -}}
  {{- $perf := dict "@type" "Person" "name" .name -}}
  {{- with .image }}{{ $perf = merge $perf (dict "image" .) }}{{ end -}}
  {{- with .jobTitle }}{{ $perf = merge $perf (dict "jobTitle" .) }}{{ end -}}
  {{- $schema = merge $schema (dict "performer" $perf) -}}
{{- end -}}
{{- with .offers -}}
  {{- $sellerOrg := dict "@type" "Organization" "name" $site.Title -}}
  {{- $offer := dict "@type" "Offer" "url" .url "seller" $sellerOrg -}}
  {{- with .price }}{{ $offer = merge $offer (dict "price" .) }}{{ end -}}
  {{- with .priceCurrency }}{{ $offer = merge $offer (dict "priceCurrency" .) }}{{ end -}}
  {{- with .availability }}{{ $offer = merge $offer (dict "availability" .) }}{{ else }}{{ $offer = merge $offer (dict "availability" "https://schema.org/InStock") }}{{ end -}}
  {{- with .validFrom }}{{ $offer = merge $offer (dict "validFrom" .) }}{{ end -}}
  {{- $schema = merge $schema (dict "offers" $offer) -}}
{{- end -}}
{{- with .audience -}}
  {{- $schema = merge $schema (dict "audience" (dict "@type" "Audience" "audienceType" .)) -}}
{{- end -}}
{{- with .isAccessibleForFree }}{{ $schema = merge $schema (dict "isAccessibleForFree" .) }}{{ end -}}
{{- with .url }}{{ $schema = merge $schema (dict "url" .) }}{{ end -}}
<script type="application/ld+json">
{{- $schema | jsonify | safeJS -}}
</script>
{{ end }}
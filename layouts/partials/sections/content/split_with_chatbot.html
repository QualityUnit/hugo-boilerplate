{{/*
Responsive two-column layout with text content and embedded FlowHunt chatbot.
Based on split_with_image.html pattern with chatbot from hero/split_with_chatbot.html.

Parameters:
- theme: "light" | "dark" | "alternate" | "gradient" (default: "light")
- backgroundColor: Custom background color class
- id: Section ID for anchor links
- eyebrow, heading, description: Text content
- chatbotId: FlowHunt chatbot ID (required)
- workspaceId: FlowHunt workspace ID (required)
- maxWindowHeight: Max height for chatbot window (default: "500px")
- link, linkText, buttonStyle: CTA button
- sectionVerticalSpacing: Custom vertical spacing
*/}}

{{ $theme := .theme | default "light" }}
{{ $backgroundColor := .backgroundColor | default "" }}
{{ $isDark := eq $theme "dark" }}
{{ $isAlternate := eq $theme "alternate" }}
{{ $isGradient := eq $theme "gradient" }}
{{ $id := .id | default "" }}

{{ $eyebrow := .eyebrow | default "" }}
{{ $heading := .heading | default "" }}
{{ $description := .description | default "" }}
{{ $chatbotId := .chatbotId | default "" }}
{{ $workspaceId := .workspaceId | default "" }}
{{ $maxWindowHeight := .maxWindowHeight | default "500px" }}

{{ $link := "" }}
{{ if .link }}
  {{ $link = partial "helpers/get-translated-url.html" (dict "url" .link) }}
{{ end }}
{{ $linkText := .linkText | default "Learn more" }}
{{ $linkTarget := .linkTarget | default "_self" }}
{{ $buttonStyle := .buttonStyle | default "primary" }}

{{ $sectionVerticalSpacing := .sectionVerticalSpacing | default "my-24 sm:my-32" }}
{{ $finalSpacing := cond (or $isDark $isAlternate $isGradient) "py-24 sm:py-32" $sectionVerticalSpacing }}
{{ $headingTracking := "tracking-[-2.832px]" }}

<div {{ if $id }}id="{{ $id }}"{{ end }} class="split-with-chatbot-section {{ if $backgroundColor }}{{ $backgroundColor }}{{ else if $isDark }}dark section-bg-dark{{ else if $isAlternate }}section-bg-alternate{{ else if $isGradient }}section-bg-gradient{{ else }}section-bg-light{{ end }} {{ $finalSpacing }}">
  <div class="wrapper flex flex-col lg:flex-row lg:justify-between lg:items-stretch gap-x-8 lg:flex-row-reverse">
    {{/* Right side: Chatbot */}}
    <div class="lg:flex lg:w-1/2 lg:items-start lg:shrink lg:grow-0">
      <div class="relative rounded-lg py-6 flex items-start justify-center w-full overflow-hidden mx-auto max-w-[38rem] max-h-[35rem]">
        {{ if $chatbotId }}
        <div id="fh-chatbot-container-{{ $chatbotId }}" class="w-full h-full overflow-hidden">
        </div>
        <script>
        (function() {
          var container = document.getElementById('fh-chatbot-container-{{ $chatbotId }}');
          var loaded = false;

          var observer = new IntersectionObserver(function(entries) {
            if (entries[0].isIntersecting && !loaded) {
              loaded = true;
              observer.disconnect();

              var script = document.createElement('script');
              script.id = 'fh-chatbot-script-{{ $chatbotId }}';
              script.async = true;
              script.src = 'https://app.flowhunt.io/api/chatbot/{{ $chatbotId }}?workspace_id={{ $workspaceId }}';
              script.onload = function() {
                {{ $chatbotVar := replace $chatbotId "-" "_" }}
                {{ printf "window.FHChatbot_%s.setConfig({\"embedded\": true, \"maxWindowHeight\": \"%s\"});" $chatbotVar $maxWindowHeight | safeJS }}
                {{ printf "window.FHChatbot_%s.init(function(chatbotManager) {});" $chatbotVar | safeJS }}
              };
              container.appendChild(script);
            }
          }, { rootMargin: '200px' });

          observer.observe(container);
        })();
        </script>
        {{ end }}
      </div>
    </div>
    {{/* Left side: Text content */}}
    <div class="max-md:-order-1 lg:flex lg:w-1/2 lg:items-center">
      <div class="py-4 lg:w-full lg:flex-none lg:pr-20">
        {{ if $eyebrow }}
          <p class="text-base/7 font-semibold product-text">{{ $eyebrow }}</p>
        {{ end }}
        {{ if $heading }}
          <h2 class="mt-3 mb-0 text-4xl font-semibold {{ $headingTracking }} text-heading leading-none text-pretty sm:text-5xl">{{ $heading }}</h2>
        {{ end }}
        {{ if $description }}
          <p class="mt-6 text-lg/7 text-secondary prose-links">{{ $description | safeHTML }}</p>
        {{ end }}
        {{ if $link }}
        <div class="mt-6">
          {{ partial "components/buttons/buttons.html" (dict
            "text" $linkText
            "url" $link
            "target" $linkTarget
            "variant" $buttonStyle
          ) }}
        </div>
        {{ end }}
      </div>
    </div>
  </div>
</div>

{{/*
@section: Pricing with Comparison Table
@description: A comprehensive pricing section that displays multiple pricing tiersComparison with a detailed feature comparison table, including both mobile and desktop views.
@params:
  - taglineComparison: Text above the heading (optional, default: "Pricing")
  - headingComparison: Main heading text (optional, default: "Pricing that grows with you")
  - descriptionComparison: Text below the heading (optional, default: "Choose an affordable plan...")
  - backgroundColorComparison: Background color for the section (optional, default: "white")
  - taglineColorComparison: Color for the tagline text (optional, default: "indigo-600")
  - headingColorComparison: Color for the heading text (optional, default: "gray-900")
  - descriptionColorComparison: Color for the description text (optional, default: "gray-600")
  - checkColorComparison: Color for the checkmark icons (optional, default: "indigo-600")
  - dashColorComparison: Color for the dash icons (optional, default: "gray-400")
  - togglePrice: Boolean to control whether to show the monthly/annual pricing toggle (optional, default: false)
  - tiersComparison: Array of tier objects (optional, includes defaults)
    - name: Name of the tier
    - id: ID for accessibility
    - emphasized: Boolean to indicate if this is the emphasized tier
    - monthlyPrice: The monthly price to display
    - annualPrice: The annual price to display (only shown when togglePrice is true)
    - interval: The price interval text (e.g. "/month")
    - cta: Object with text and url for the call-to-action button
    - ctaColor: Color for the CTA button text
    - ctaBgColor: Color for the CTA button background (for filled buttons)
    - ctaHoverBgColor: Color for the CTA button hover background (for filled buttons)
    - ctaBorderColor: Color for the CTA button border (for outline buttons)
    - ctaHoverBorderColor: Color for the CTA button hover border (for outline buttons)
  - featureCategories: Array of feature category objects (optional, includes defaults)
    - name: Name of the category
    - features: Array of feature objects
      - name: Name of the feature
      - tiersComparison: Object with tier names as keys and feature values as values
        (can be boolean, string, or number)
@example:
  {{ partial "sections/pricing/with_comparison_table.html" (dict
      "taglineComparison" "Plans"
      "headingComparison" "Find the right plan for your business"
      "descriptionComparison" "Whether you're a startup or enterprise, we have a plan that fits your needs and budget."
      "tiersComparison" (slice
          (dict
              "name" "Basic"
              "id" "tier-basic"
              "emphasized" false
              "cta" (dict "text" "Get started" "url" "/signup/basic")
              "ctaColor" "indigo-600"
              "ctaBorderColor" "indigo-200"
              "ctaHoverBorderColor" "indigo-300"
          )
          (dict
              "name" "Pro"
              "id" "tier-pro"
              "emphasized" true
              "cta" (dict "text" "Get started" "url" "/signup/pro")
              "ctaColor" "white"
              "ctaBgColor" "indigo-600"
              "ctaHoverBgColor" "indigo-500"
          )
          (dict
              "name" "Enterprise"
              "id" "tier-enterprise"
              "emphasized" false
              "cta" (dict "text" "Contact sales" "url" "/contact")
              "ctaColor" "indigo-600"
              "ctaBorderColor" "indigo-200"
              "ctaHoverBorderColor" "indigo-300"
          )
      )
      "featureCategories" (slice
          (dict
              "name" "Core Features"
              "features" (slice
                  (dict
                      "name" "Storage"
                      "tiersComparison" (dict "Basic" "10GB" "Pro" "50GB" "Enterprise" "Unlimited")
                  )
                  (dict
                      "name" "API access"
                      "tiersComparison" (dict "Basic" false "Pro" true "Enterprise" true)
                  )
              )
          )
          (dict
              "name" "Support"
              "features" (slice
                  (dict
                      "name" "Priority support"
                      "tiersComparison" (dict "Basic" false "Pro" true "Enterprise" true)
                  )
                  (dict
                      "name" "Dedicated account manager"
                      "tiersComparison" (dict "Basic" false "Pro" false "Enterprise" true)
                  )
              )
          )
      )
  ) }}
@note: This section automatically adapts between mobile and desktop views. On mobile, each tier is displayed as a card in a vertical stack, while on desktop it shows a full comparison table. The emphasized tier is visually highlighted to draw attention to your recommended plan.
*/}}

{{/*
  With Comparison Table Pricing Section

  Parameters:
  - taglineComparison: Text above the heading (default: "Our Plans")
  - headingComparison: Main heading text (default: "Compare plans")
  - descriptionComparison: Text below the heading (default: "Check out our plan comparisons and select the best one for you")
  - backgroundColorComparison: Background color for the section (default: "white")
  - taglineColorComparison: Color for the tagline text (default: "indigo-600")
  - headingColorComparison: Color for the heading text (default: "gray-900")
  - descriptionColorComparison: Color for the description text (default: "gray-600")
  - checkColorComparison: Color for the checkmark icons (default: "primary")
  - dashColorComparison: Color for the dash icons (default: "gray-400")
  - togglePrice: Boolean to control whether to show the monthly/annual pricing toggle (default: false)
  - tiersComparison: Array of tier configurations, each with:
    - name: Name of the tier
    - id: ID for accessibility
    - emphasized: Boolean to indicate if this is the emphasized tier
    - monthlyPrice: The monthly price to display
    - annualPrice: The annual price to display (only shown when togglePrice is true)
    - interval: The price interval text (e.g. "/month")
    - cta: Object with text and url for the call-to-action button
    - ctaColor: Color for the CTA button text
    - ctaBgColor: Color for the CTA button background (for filled buttons)
    - ctaHoverBgColor: Color for the CTA button hover background (for filled buttons)
    - ctaBorderColor: Color for the CTA button border (for outline buttons)
    - ctaHoverBorderColor: Color for the CTA button hover border (for outline buttons)
  - featureCategories: Array of feature categories, each with:
    - name: Name of the category
    - features: Array of features, each with:
      - name: Name of the feature
      - tiersComparison: Object with tier names as keys and feature values as values
        (can be boolean, string, or number)
*/}}

{{ $taglineComparison := .taglineComparison }}
{{ $headingComparison := .headingComparison }}
{{ $descriptionComparison := .descriptionComparison }}
{{ $backgroundColorComparison := .backgroundColorComparison }}
{{ $taglineColorComparison := .taglineColorComparison }}
{{ $headingColorComparison := .headingColorComparison }}
{{ $descriptionColorComparison := .descriptionColorComparison }}
{{ $checkColorComparison := .checkColorComparison }}
{{ $dashColorComparison := .dashColorComparison }}
{{ $toggleTextColor := .toggleTextColor }}
{{ $toggleActiveColor := .toggleActiveColor }}
{{ $toggleActiveBgColor := .toggleActiveBgColor }}
{{ $toggleBorderColor := .toggleBorderColor }}
{{ $togglePrice := .togglePrice }}
{{ $tiersComparison := .tiersComparison }}
{{ $featureCategories := .featureCategories }}

{{ if (gt (len $tiersComparison) 0) }}
    <div id="comparison-table" class="bg-{{ $backgroundColorComparison }} py-12 hidden md:block">
        <div class="mx-auto max-w-7xl">
            <div class="mx-auto max-w-4xl text-center">
                {{ if $headingComparison }}
                    <h2 class="text-base/7 font-semibold text-{{ $taglineColorComparison }}">{{ $taglineComparison }}</h2>
                {{ end }}
                <p class="mt-2 mb-2 text-5xl font-semibold tracking-tight text-balance text-{{ $headingColorComparison }} sm:text-6xl">{{ $headingComparison }}</p>
            </div>
            <p class="mx-auto mt-6 max-w-2xl text-center text-lg font-medium text-pretty text-{{ $descriptionColorComparison }} sm:text-xl/8">{{ $descriptionComparison }}</p>
            <div class="mt-8 flex justify-center">
                {{ if $togglePrice }}
                    <fieldset aria-label="Payment frequency">
                        <div class="grid grid-cols-2 gap-x-1 rounded-full p-1 text-center text-xs/5 font-semibold ring-1 ring-{{ $toggleBorderColor }} ring-inset">
                            <!-- Monthly option -->
                            <label class="cursor-pointer rounded-full px-2.5 py-1 bg-{{ $toggleActiveBgColor }} text-{{ $toggleActiveColor }}"
                                   id="monthly-label">
                                <input type="radio" name="frequency" value="monthly" class="sr-only" checked>
                                <span>{{ i18n "pricing_monthly_label" }}</span>
                            </label>
                            <!-- Annual option -->
                            <label class="cursor-pointer rounded-full px-2.5 py-1 text-{{ $toggleTextColor }}"
                                   id="annually-label">
                                <input type="radio" name="frequency" value="annually" class="sr-only">
                                <span>{{ i18n "pricing_yearly_label" }}</span>
                            </label>
                        </div>
                    </fieldset>
                {{ end }}
            </div>
            <div class="isolate mt-20">
                <div class="relative -mx-8">
                    {{ $columnCount := add (len $tiersComparison) 1 }}
                    {{ range $index, $tier := $tiersComparison }}
                        {{ if $tier.emphasized }}
                            {{ $columnWidth := div 100 $columnCount }}
                            {{ $marginLeft := mul $columnWidth (add $index 1) }}
                            <div
                                    class="pointer-events-none absolute top-0 left-0 -z-10 h-full px-4"
                                    style="width: {{ $columnWidth }}%; margin-left: {{ $marginLeft }}%;">
                                <div class="w-full rounded-t-xl border-x border-t border-gray-900/10 bg-gray-400/5 h-full"></div>
                            </div>
                        {{ end }}
                    {{ end }}
                    <table class="w-full table-fixed border-separate border-spacing-x-8 text-left">
                        <colgroup>
                            <col class="w-1/4">
                            {{ range $tiersComparison }}
                                <col class="w-1/4">
                            {{ end }}
                        </colgroup>
                        <thead>
                        <tr>
                            <td></td>
                            {{ range $tiersComparison }}
                                <th scope="col" class="px-6 pt-6 xl:px-8 xl:pt-8">
                                    <div class="text-sm/7 font-semibold text-gray-900">{{ .name }}</div>
                                </th>
                            {{ end }}
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th scope="row"></th>
                            {{ range $tier := $tiersComparison }}
                                <td class="px-6 pt-2 xl:px-8">
                                    <p class="mt-6 flex items-baseline gap-x-1">
                                        {{ if $togglePrice }}
                                            <!-- Monthly price (default visible) -->
                                            <span class="text-4xl font-semibold tracking-tight text-{{ $tier.priceColor }} monthly-price">{{ $tier.monthlyPrice }}</span>
                                            <!-- Annual price (hidden by default) -->
                                            <span class="text-4xl font-semibold tracking-tight text-{{ $tier.priceColor }} annual-price hidden">{{ $tier.annualPrice }}</span>
                                        {{ else }}
                                            <!-- Only monthly price when toggle is disabled -->
                                            <span class="text-4xl font-semibold tracking-tight text-{{ $tier.priceColor }}">{{ $tier.monthlyPrice }}</span>
                                        {{ end }}
                                        <!-- Interval -->
                                        <span class="text-sm/6 font-semibold text-{{ $tier.intervalColor }}">{{ $tier.interval }}</span>
                                    </p>
                                    {{ if $tier.emphasized }}
                                        <a href="{{ $tier.cta.url }}"
                                           class="mt-8 not-prose block rounded-md bg-{{ $tier.ctaBgColor }} px-3 py-2 text-center text-sm/6 font-semibold text-{{ $tier.ctaColor }} hover:bg-{{ $tier.ctaHoverBgColor }} focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">{{ $tier.cta.text }}</a>
                                    {{ else }}
                                        <a href="{{ $tier.cta.url }}"
                                           class="mt-8 not-prose block rounded-md px-3 py-2 text-center text-sm/6 font-semibold text-{{ $tier.ctaColor }} ring-1 ring-{{ $tier.ctaBorderColor }} ring-inset hover:ring-{{ $tier.ctaHoverBorderColor }} focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">{{ $tier.cta.text }}</a>
                                    {{ end }}
                                </td>
                            {{ end }}
                        </tr>

                        {{ range $categoryIndex, $category := $featureCategories }}
                            <tr>
                                <th scope="colgroup" colspan="{{ add (len $tiersComparison) 1 }}"
                                    class="pt-{{ if eq $categoryIndex 0 }}8{{ else }}16{{ end }} pb-4 text-sm/6 font-semibold text-gray-900">
                                    {{ $category.name }}
                                    <div class="absolute inset-x-8 mt-4 h-px bg-gray-900/10"></div>
                                </th>
                            </tr>

                            {{ range $featureIndex, $feature := $category.features }}
                                <tr>
                                    <th scope="row" class="not-prose py-4 text-sm/6 font-normal text-gray-900">
                                        {{ if $feature.tooltip }}
                                            {{ partial "components/tooltip/tooltip.html" (dict "content" $feature.name "text" $feature.tooltip) }}
                                        {{ else }}
                                            {{ $feature.name }}
                                        {{ end }}
                                        <div class="absolute inset-x-8 mt-4 h-px bg-gray-900/5"></div>
                                    </th>

                                    {{ range $tierIndex, $tier := $tiersComparison }}
                                        {{ $tierValue := index $feature.tiersComparison $tier.name }}
                                        <td class="px-6 py-4 xl:px-8">
                                            {{ if eq $tierValue true }}
                                                {{ partial "icons/check" "mx-auto size-5 text-{{ $checkColorComparison }}" }}
                                            {{ else if eq $tierValue false }}
                                                {{ partial "icons/minus" "mx-auto size-5 text-{{ $dashColorComparison }}" }}
                                            {{ else }}
                                                <div class="text-center text-sm/6 text-gray-500">{{ $tierValue }}</div>
                                            {{ end }}
                                        </td>
                                    {{ end }}
                                </tr>
                            {{ end }}
                        {{ end }}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    {{ if $togglePrice }}
        <!-- JavaScript for toggle functionality -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                if (window.innerWidth < 768) {
                    return;
                }

                const monthlyLabel = document.getElementById('monthly-label');
                const annuallyLabel = document.getElementById('annually-label');
                const monthlyPrices = document.querySelectorAll('.monthly-price');
                const annualPrices = document.querySelectorAll('.annual-price');

                // Function to toggle between monthly and annual pricing
                function togglePricing(isMonthly) {

                    if (isMonthly) {
                        monthlyLabel.classList.add('bg-{{ $toggleActiveBgColor }}', 'text-{{ $toggleActiveColor }}');
                        monthlyLabel.classList.remove('text-{{ $toggleTextColor }}');
                        annuallyLabel.classList.remove('bg-{{ $toggleActiveBgColor }}', 'text-{{ $toggleActiveColor }}');
                        annuallyLabel.classList.add('text-{{ $toggleTextColor }}');

                        monthlyPrices.forEach(el => el.classList.remove('hidden'));
                        annualPrices.forEach(el => el.classList.add('hidden'));
                    } else {
                        annuallyLabel.classList.add('bg-{{ $toggleActiveBgColor }}', 'text-{{ $toggleActiveColor }}');
                        annuallyLabel.classList.remove('text-{{ $toggleTextColor }}');
                        monthlyLabel.classList.remove('bg-{{ $toggleActiveBgColor }}', 'text-{{ $toggleActiveColor }}');
                        monthlyLabel.classList.add('text-{{ $toggleTextColor }}');

                        monthlyPrices.forEach(el => el.classList.add('hidden'));
                        annualPrices.forEach(el => el.classList.remove('hidden'));
                    }
                }

                // Set up event listeners for the toggle
                monthlyLabel.addEventListener('click', function () {
                    togglePricing(true);
                });

                annuallyLabel.addEventListener('click', function () {
                    togglePricing(false);
                });

                // Initialize with monthly pricing
                togglePricing(true);

                // Recheck on window resize
                window.addEventListener('resize', function () {
                    if (window.innerWidth < 768) {
                        return;
                    }
                });
            });
        </script>
    {{ end }}
{{ end }}

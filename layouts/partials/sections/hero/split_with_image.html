{{/*
Responsive hero section with split layout - content left, image/video right.

Parameters:
- type: "default" | "simple_base" | "features" | "integrations" | "success-stories" | feature category (default: "default")
  - "default": Standard hero with image background
  - "simple_base": Simple hero without image (handled by hero_default.html, not this component)
  - "features": Generic features hero with icon overlay
  - "integrations": Integration hero with logo overlay
  - "success-stories": Success story hero with icon overlay on the right side
  - Feature categories: "promotional-materials", "reporting", "commissions", "user-interface", "tracking", "security"
    (automatically treated as features type with specific icon color)
- theme: "light" | "dark" | "alternate" (default: "light")
- image, imageAlt: Image settings
  - For type "default": Just background image, no overlay
  - For type "features" or feature categories: Background image + SVG icon overlay in square
  - For type "integrations": integration-detail.png background + logo overlay in square
- icon: Icon path - SVG for features, image for success-stories/integrations
- video: Video object with properties (optional, takes priority over image if enabled):
  - enabled: Boolean to enable video mode (default: false)
  - src: YouTube URL for the video
  - poster: Custom poster/thumbnail image for the video (falls back to imageUrl if not provided)
- eyebrow, heading, description: Text content
- cta: Call-to-action buttons
  - primary: Primary button (text, url)
  - secondary: Secondary button (text, url)
- date: Publication date (Hugo time object)
- lastmod: Last modification date (Hugo time object)
- author: Author key/identifier (string) - will create link to /author/{author}/ if page exists
- showPublicationInfo: Boolean to show/hide date and author information (default: false)
- tags: Array of tags (optional), will create tag links to /tags/[tag-name]/
- categories: Array of categories (optional), will create category links to /categories/[category-name]
- badges: Array of badge texts (optional), displayed as styled badges
- resources: Array of resource objects with 'name' and 'link' properties (optional), displayed as download buttons
- useCaseImprovements: Array of improvement objects with 'improvement' and 'text' properties (optional), displayed as hero statistics
- typewriter: Object with typewriter effect configuration (optional)
  - enabled: Boolean to enable/disable the effect (default: false)
  - words: Number of words to animate (default: 1)
  - speed: Typing speed in ms (default: 100)
  - deleteSpeed: Deleting speed in ms (default: 50)
  - pause: Pause duration in ms (default: 2000)
  - color: Color class for animated text (default: "text-indigo-600")
  - wordAlternatives: Comma separated words to alternate with
- sectionPaddingY: Custom vertical padding using Tailwind classes (default: "max-md:pt-0 py-12 lg:py-16")
- backgroundColor: Custom background color class
- overlayPosition: Position of icon overlay (default: "top-[5.69rem] left-[1.25rem]", for success-stories: "top-12 right-3 xl:-right-10")
- overlaySize: Size of overlay container (default: "w-[7.88rem] h-[7.88rem]")
- overlayIconSizeIntegrations: Size of integration icons (default: "w-[6.25rem] h-[6.25rem]")
- overlayIconSizeFeatures: Size of feature icons (default: "w-[4.25rem] h-[4.25rem]")
- overlayShadowClass: CSS class for overlay shadow (default: "hero-overlay-shadow")
- contentLeftPadding: Left padding for content area (default: "lg:pr-0")
- customBackground: Custom background image path for integrations type (optional)

Image Handling by Type:
- type="default": Uses image parameter for background, no overlay square
- type="simple_base": Not handled by this component (uses simple_base.html instead)
- type="features": Uses image parameter for background, icon parameter for SVG overlay in square (green default color)
- type=feature category: Uses image parameter for background, icon parameter for SVG overlay with category-specific color
  - "tracking"=sky-600, "commissions"=yellow-600, "reporting"=fuchsia-600, etc.
- type="integrations": Uses /images/integration-methods/integration-detail.png for background, image parameter for logo overlay in square

Custom Color Classes Documentation:
- text-heading: Primary heading text color (typically dark for contrast)
- text-primary: Brand primary color for accents and CTAs
- text-secondary: Standard body text color (readable gray)
- text-gray-700: Tailwind gray-700 for secondary text
- section-bg-light: Light background for sections

Usage Guidelines:
- Use text-heading for main headings and emphasized text elements
- Use text-primary for brand accents, links, and call-to-action elements
- Use text-secondary for regular paragraph text and descriptions
- Ensure color contrast meets accessibility standards (WCAG AA)
- When video.enabled is true, video will be displayed with popup functionality
- Video supports YouTube URLs and will open in lightbox popup on click

Design Tokens:
- Image dimensions are configurable via variables for easy maintenance
- Spacing values use consistent design system tokens
- Typography tracking and sizing follow brand guidelines
- Media (image/video) is always positioned on the right side
*/}}

{{ $theme := .theme | default "light" }}
{{ $backgroundColor := .backgroundColor | default "" }}
{{ $isDark := eq $theme "dark" }}
{{ $isAlternate := eq $theme "alternate" }}

{{/* Section parameters */}}
{{ $type := .type | default "default" }}
{{ $image := .image }}
{{ $imageAlt := .imageAlt }}
{{ $icon := .icon }}
{{ $features := .features | default (slice) }}
{{ $video := .video | default (dict "enabled" false) }}
{{ $eyebrow := .eyebrow }}
{{ $heading := .heading }}
{{ $description := .description }}
{{ $cta := .cta }}
{{ $tags := .tags | default (slice) }}
{{ $categories := .categories | default (slice) }}
{{ $badgesRaw := .badges | default (slice) }}
{{ $badges := slice }}
{{ if $badgesRaw }}
  {{ if eq (printf "%T" $badgesRaw) "string" }}
    {{/* Convert comma-separated string to slice */}}
    {{ $badgesList := split $badgesRaw "," }}
    {{ range $badgesList }}
      {{ $badges = $badges | append (trim . " ") }}
    {{ end }}
  {{ else }}
    {{ $badges = $badgesRaw }}
  {{ end }}
{{ end }}
{{ $resources := .resources | default (slice) }}
{{ $useCaseImprovements := .useCaseImprovements | default (slice) }}
{{ $typewriter := .typewriter | default dict }}
{{ $search := .search | default dict }}
{{ $checklist := .checklist | default dict }}
{{ $date := .date }}
{{ $lastmod := .lastmod }}
{{ $author := .author }}
{{ $showPublicationInfo := .showPublicationInfo | default false }}
{{ $customBackground := .customBackground }}

{{/* Typewriter configuration with defaults */}}
{{ $typewriter := merge (dict "enabled" false) $typewriter }}

{{/* Search configuration with defaults */}}
{{ $search := merge (dict "enabled" false) $search }}
{{ $search := merge (dict "directories" (slice)) $search }}
{{ $search := merge (dict "placeholder" (i18n "search_placeholder")) $search }}
{{ $search := merge (dict "searchFields" (slice "title" "content" "tags" "categories")) $search }}
{{ $typewriter := merge (dict "words" "1") $typewriter }}
{{ $typewriter := merge (dict "speed" 100) $typewriter }}
{{ $typewriter := merge (dict "deleteSpeed" 50) $typewriter }}
{{ $typewriter := merge (dict "pause" 2000) $typewriter }}
{{ $typewriter := merge (dict "color" "text-indigo-600") $typewriter }}
{{ $typewriter := merge (dict "wordAlternatives" "") $typewriter }}

{{/* Design tokens and configurable dimensions */}}
{{ $sectionPaddingY := .sectionPaddingY | default "max-md:pt-0 py-12 lg:py-16" }}
{{ $imageContainerPaddingY := "py-0" }}
{{ $contentPaddingY := "py-4" }}
{{ $contentLeftPadding := .contentLeftPadding | default "lg:pr-0" }}
{{ $headingTracking := "tracking-[-2.832px]" }}

{{/* Overlay configuration */}}
{{ $overlayPosition := .overlayPosition | default "top-[5.69rem] left-[1.25rem]" }}
{{ $overlaySize := .overlaySize | default "w-[7.88rem] h-[7.88rem]" }}
{{ $overlayIconSizeIntegrations := .overlayIconSizeIntegrations | default "w-[6.25rem] h-[6.25rem]" }}
{{ $overlayIconSizeFeatures := .overlayIconSizeFeatures | default "w-[4.25rem] h-[4.25rem]" }}
{{ $overlayShadowClass := .overlayShadowClass | default "hero-overlay-shadow" }}
{{ $overflowClass := "overflow-hidden" }}

{{/* Hero type configuration - loaded from helper partial */}}
{{ $config := partial "helpers/split_with_image_config.html" (dict "type" $type "customBackground" $customBackground "image" $image) }}

{{/* Image processing */}}
{{ $imageSrc := "" }}
{{ $finalImageAlt := $imageAlt | default $heading | default .Title | default "Hero image" }}

{{/* Background image source logic - universal approach */}}
{{ if $config.customBackground }}
  {{ $imageSrc = $config.customBackground }}
{{ else if $image }}
  {{/* Fallback to regular image */}}
  {{ if reflect.IsMap $image }}
    {{ $imageSrc = $image.url }}
    {{ $finalImageAlt = $image.alt | default $finalImageAlt }}
  {{ else }}
    {{ $imageSrc = $image }}
  {{ end }}
{{ end }}

{{/* Overlay icon source logic - configurable approach */}}
{{ $showOverlay := $config.showOverlay }}
{{ $iconImageSrc := "" }}
{{ if eq $config.overlayMode "image" }}
  {{/* Image mode: check if should use icon as overlay instead of main image */}}
  {{ if $config.useIconAsOverlay }}
    {{ $iconImageSrc = $icon }}
    {{/* Fallback to default icon if no icon provided */}}
    {{ if and (not $iconImageSrc) $config.defaultIcon }}
      {{ $iconImageSrc = $config.defaultIcon }}
    {{ end }}
  {{ else }}
    {{ if reflect.IsMap $image }}
      {{ $iconImageSrc = $image.url }}
    {{ else }}
      {{ $iconImageSrc = $image }}
    {{ end }}
  {{ end }}
  {{ $showOverlay = and $showOverlay (ne $iconImageSrc "") }}
{{ else if eq $config.overlayMode "svg" }}
  {{/* SVG mode: use icon parameter (features) */}}
  {{ $iconImageSrc = $icon }}
  {{ $showOverlay = and $showOverlay (ne $iconImageSrc "") }}
{{ end }}

{{/* Overlay position - right for success-stories, left for others */}}
{{ if $config.overlayPositionRight }}
  {{ $overlayPosition = "top-12 right-3 xl:-right-10" }}
  {{ $overlaySize = "w-auto h-[8.75rem]" }}
  {{ $overflowClass = "overflow-hidden xl:overflow-visible" }}
{{ end }}

<div class="split-with-image-hero {{ if $backgroundColor }}{{ $backgroundColor }}{{ else if $isDark }}dark section-bg-dark{{ else if $isAlternate }}section-bg-alternate{{ else }}section-bg-light{{ end }} {{ $sectionPaddingY }}">
  <div class="wrapper lg:flex lg:justify-between lg:items-stretch gap-x-8 lg:flex-row-reverse">
    <div class="hidden lg:flex lg:w-1/2 lg:items-start lg:shrink lg:grow-0 xl:relative xl:inset-y-0 xl:left-0">
      <div class="relative rounded-lg {{ $imageContainerPaddingY }} flex items-start justify-center w-full {{ $overflowClass }} mx-auto max-w-[38rem] max-h-full">
        {{ if and $video $video.enabled }}
          {{/* Display video with popup */}}
          {{ partial "components/media/video.html" (dict 
              "src" $video.src 
              "poster" $video.poster 
              "title" $heading
              "class" "rounded-lg w-full h-auto"
              "provider" "youtube"
              "playBtnClass" ""
              "posterHeight" "h-full"
              "showPlayButton" $video.showPlayButton
              "useLightbox" true
              "noLazy" true
          ) }}
        {{ else }}
          {{/* Display regular image */}}
          {{ if and $showOverlay $iconImageSrc }}
            {{ if $config.showDoubleIcon }}
              {{/* Success Stories - Double Icon Layout */}}
              {{ partial "components/success-stories/double-icon-overlay.html" (dict
                "primaryIcon" $iconImageSrc
                "secondaryIcon" $config.defaultIcon
                "overlayPosition" $overlayPosition
                "overlaySize" $overlaySize
                "overlayShadowClass" $overlayShadowClass
              ) }}
            {{ else }}
              {{/* Standard Single Icon Overlay */}}
              <div class="absolute {{ $overlayPosition }} z-10 {{ $overlaySize }} rounded-xl border border-gray-200 bg-gradient-to-b from-gray-50 to-gray-50 opacity-80 flex items-center justify-center backdrop-blur-sm {{ $overlayShadowClass }}">
                {{ if eq $config.overlayMode "image" }}
                  {{/* Integration logo (Image Overlay) */}}
                  {{ partial "components/media/lazyimg.html" (dict
                    "src" $iconImageSrc
                    "alt" "Integration logo"
                    "class" (printf "%s object-contain" $overlayIconSizeIntegrations)
                    "noLazy" true
                  ) }}
                {{ else if eq $config.overlayMode "svg" }}
                  {{/* Feature SVG icon (SVG Overlay) */}}
                  {{ partial "components/media/svg-icon.html" (dict
                    "src" $iconImageSrc
                    "alt" "Feature icon"
                    "class" (printf "%s %s" $overlayIconSizeFeatures $config.overlayColor)
                  ) }}
                {{ end }}
              </div>
            {{ end }}
          {{ end }}
          {{/* Determine image class based on file type */}}
          {{ $imageClass := "object-contain rounded-lg" }}
          {{ if or (strings.HasSuffix $imageSrc ".svg") (strings.HasSuffix $imageSrc ".SVG") }}
            {{ $imageClass = "w-full h-full max-w-full max-h-full" }}
          {{ end }}
          {{ partial "components/media/lazyimg.html" (dict
              "src" $imageSrc
              "alt" $finalImageAlt
              "class" $imageClass
              "noLazy" true
            ) }}
        {{ end }}
      </div>
    </div>
    <div class="lg:flex lg:w-1/2 lg:items-center">
      <div class="{{ $contentPaddingY }} lg:w-full lg:flex-none {{ $contentLeftPadding }}">
        {{ if eq $type "success-stories" }}
          {{/* Success Stories - simplified content: heading, description, improvements only */}}
          {{ partial "sections/hero/split_left_success_stories.html" (dict
            "heading" $heading
            "description" $description
            "useCaseImprovements" $useCaseImprovements
          ) }}
        {{ else }}
          {{/* Default content rendering */}}
          {{ if $eyebrow }}
            <p class="text-base/7 font-semibold text-primary">{{ $eyebrow }}</p>
          {{ end }}
          {{ if $heading }}
            {{ $headingLength := len $heading }}
            {{ $lineHeightClass := "leading-tight" }}

            {{/* Get dynamic font classes from shared partial */}}
            {{ $fontConfig := partial "helpers/dynamic-font-classes.html" (dict "headingLength" $headingLength) }}
            {{ $fontSizeClass := $fontConfig.fontSizeClass }}
            {{ $headingTracking := $fontConfig.headingTracking }}
            
            {{/* Build typewriter attributes efficiently */}}
            {{ $typewriterAttrs := "" }}
            {{ if $typewriter.enabled }}
              {{ $typewriterAttrs = printf ` data-typewriter data-typewriter-words="%s" data-typewriter-word-alternatives="%s" data-typewriter-speed="%d" data-typewriter-delete-speed="%d" data-typewriter-pause="%d" data-typewriter-color="%s"` $typewriter.words $typewriter.wordAlternatives $typewriter.speed $typewriter.deleteSpeed $typewriter.pause $typewriter.color }}
            {{ end }}

            <h1 class="mt-6 {{ $fontSizeClass }} font-semibold {{ $headingTracking }} text-heading {{ $lineHeightClass }}"{{ $typewriterAttrs | safeHTMLAttr }}>
              {{ $heading }}
            </h1>
          {{ end }}
          {{ if $description }}
            <p class="mt-8 text-lg/7 text-secondary sm:text-xl/8 prose-links">{{ $description | safeHTML }}</p>
          {{ end }}

        {{ if and $showPublicationInfo (or $date $lastmod $author) }}
          <div class="mt-6 text-sm text-secondary/8">
            {{ $dateFormat := "Jan 2, 2006" }}
            {{ $timeFormat := "3:04 pm" }}
            
            {{ with $date }}
              {{ if $author }}
                {{ $authorPath := printf "author/%s" $author }}
                {{ $authorName := $author }}
                {{ with site.GetPage $authorPath }}
                  {{ $authorName = printf `<a href="%s" class="font-medium text-primary hover:text-primary-dark underline">%s</a>` .Permalink .Title }}
                {{ else }}
                  {{ $authorName = printf `<span class="font-medium">%s</span>` $author }}
                {{ end }}
                <span>{{ printf (i18n "published_on_by" | default "Published on %s by %s.") (.Format $dateFormat) $authorName | safeHTML }}</span>
              {{ else }}
                <span>{{ printf (i18n "published_on" | default "Published on %s.") (.Format $dateFormat) }}</span>
              {{ end }}
              <time datetime="{{ .Format "2006-01-02T15:04:05Z07:00" }}" class="sr-only">
                  {{ .Format $dateFormat }}
              </time>
            {{ end }}

              {{ with $lastmod }}
                  <span> </span>
                  <span>{{ printf (i18n "last_modified_on_at" | default "Last modified on %s at %s") (.Format $dateFormat) (.Format $timeFormat) }}</span>
                  <time datetime="{{ .Format "2006-01-02T15:04:05Z07:00" }}" class="sr-only">
                      {{ .Format $dateFormat }} {{ .Format $timeFormat }}
                  </time>
              {{ end }}
            </div>
          {{ end }}

          {{/* Tags, Categories, Badges, Resources */}}
          {{ if or $categories $tags $badges $resources }}
            <div class="mt-6 flex flex-col gap-4">
              {{ if $badges }}
              <div class="flex flex-wrap gap-2">
                {{ range $badges }}
                  {{ partial "components/label/label.html" (dict 
                    "text" . 
                    "badgeClass" "badge-base badge-gray badge-with-border"
                  ) }}
                {{ end }}
              </div>
              {{ end }}

              {{ if $categories }}
              {{ $categoriesEnabled := isset site.Taxonomies "categories" }}
              <div class="flex flex-wrap gap-2">
                {{ range $categories }}
                {{ if $categoriesEnabled }}
                <a href="{{ print "/categories/" (. | urlize) | relLangURL }}/" class="inline-flex items-center rounded-full bg-indigo-50 px-3 py-1 text-sm font-medium text-primary-dark hover:bg-indigo-100">
                {{ . }}
                </a>
                {{ else }}
                <span class="inline-flex items-center rounded-full bg-indigo-50 px-3 py-1 text-sm font-medium text-primary-dark">
                {{ . }}
                </span>
                {{ end }}
                {{ end }}
              </div>
              {{ end }}

              {{ if $tags }}
                {{ partial "sections/tags/tags.html" (dict "tags" $tags "maxTags" 4 ) }}
              {{ end }}

              {{ if $resources }}
                {{ partial "sections/resources/resources.html" (dict "resources" $resources "maxItems" 4) }}
              {{ end }}
            </div>
          {{ end }}

          {{/* CTA Buttons */}}
          {{ with $cta }}
            {{ $hasPrimary := and .primary .primary.url .primary.text (ne .primary.url "") (ne .primary.text "") }}
            {{ $hasSecondary := and .secondary .secondary.url .secondary.text (ne .secondary.url "") (ne .secondary.text "") }}
            {{ if or $hasPrimary $hasSecondary }}
            <div class="mt-10 flex items-center gap-x-6">
              {{ if $hasPrimary }}
                {{ partial "components/buttons/buttons.html" (dict
                  "text" .primary.text
                  "url" .primary.url
                  "variant" "primary"
                  "size" "xl"
                ) }}
              {{ end }}
              {{ if $hasSecondary }}
                {{ partial "components/buttons/buttons.html" (dict
                  "text" .secondary.text
                  "url" .secondary.url
                  "variant" "secondary"
                  "showArrow" true
                  "size" "xl"
                ) }}
              {{ end }}
            </div>
            {{ end }}
          {{ end }}
          
          {{/* Search Field */}}
          {{ if $search.enabled }}
            <div class="mt-8 max-w-xl">
              {{ partial "search_field.html" (dict
                "type" "hero-search"
                "directories" $search.directories
                "placeholder" $search.placeholder
              ) }}
            </div>
          {{ end }}
        {{ end }}
      </div>
    </div>
  </div>

  {{/* Checklist */}}
  {{ if $checklist.enabled }}
    <div class="relative bg-white border-b border-secondary hidden lg:block" id="checklistTocStickyWrapper">
      <div class="py-6 transition-all duration-300 bg-white" id="checklistTocSticky">
        <div class="wrapper">
          {{ partial "components/checklist-toc.html" (dict "title" $heading) }}
        </div>
      </div>
    </div>
  {{ end }}

</div>

{{/*
@component: Row Card with Image
@description: Displays a blog post card with featured image on the left and content on the right. Stretches full width.
@params:
This component expects a page context (.) that has the following properties:
- Title: The title of the post
- Params.image: Featured image URL (uses a placeholder if not provided)
- Params.description or .Description or .Summary: Post description/summary
- Date: Publication date
- ReadingTime: Estimated reading time in minutes
- RelPermalink: URL to the post
- Section: The content section (e.g., "blog")
- Params.tags: Array of post tags (optional)
- Params.author: Post author name (optional)
- Params.price (optional): Price of the product (if applicable) in EUR
- imageBgColor: Background color for the image section (optional, default: rgb(249 250 251)
- cardHeight: Height of the card in pixels (optional, default: 180)
- imageWidth: Width of the image section (optional, default: 200px)
@example:
{{ partial "components/cards/row_card.html" (dict "cardHeight" 200 "imageWidth" 250 "page" .) }}
@note: This is a horizontal card with image on the left, stretching full width of parent.
*/}}

{{ $cardHeight := 180 }}
{{ if (isset . "cardHeight") }}
    {{ $cardHeight = .cardHeight }}
{{ end }}

{{ $imageWidth := 200 }}
{{ if (isset . "imageWidth") }}
    {{ $imageWidth = .imageWidth }}
{{ end }}

{{ $page := .page | default . }}
{{ $image := .image }}
{{ $title := .title }}

{{/* Summary and description */}}
{{ $description := .description }}
{{ if and $description (gt (len $description) 160) }}
    {{- $description = printf "%.160s..." $description -}}
{{ end }}

{{ $permalink := .url | default nil }}

<article class="group relative rounded-2xl flex w-full overflow-hidden surface-secondary border border-secondary" style="min-height: {{ $cardHeight }}px;">
    {{ if $image }}
        <div class="flex-none overflow-hidden" style="width: {{ $imageWidth }}px;">
            {{ if $permalink }}
                <a href="{{ $permalink }}" class="h-full w-full flex items-center justify-center">
                    {{ partial "components/media/lazyimg.html" (dict
                    "src" $image
                    "alt" $title
                    "class" "w-full h-full object-cover"
                    "classPicture" "w-full h-full object-cover"
                    "maxWidth" 300
                    ) }}
                </a>
            {{ else }}
                {{ partial "components/media/lazyimg.html" (dict
                "src" $image
                "alt" $title
                "class" "w-full h-full object-cover"
                "classPicture" "w-full h-full object-cover"
                "maxWidth" 300
                ) }}
            {{ end }}
        </div>
    {{ end }}

    <div class="flex flex-col flex-grow justify-between pt-8 pl-8 gap-8">
        <!-- Title and Description -->
        <div class="flex flex-col pr-8 gap-5">
            <h3 class="text-lg font-semibold m-0 {{ if $permalink }}group-hover:text-primary{{ end }} text-heading">
                {{ if $permalink }}
                    <a href="{{ $permalink }}" class="hover:text-primary focus:outline-none">
                        <span class="inset-0" aria-hidden="true"></span>
                        {{ $title }}
                    </a>
                {{ else }}
                    <span class="inset-0" aria-hidden="true"></span>
                    {{ $title }}
                {{ end }}
            </h3>
            {{ if $permalink }}
            <a href="{{ $permalink }}">
                <p class="text-sm leading-6 text-secondary font-normal m-0 line-clamp-3 overflow-hidden">{{ $description }}</p>
            </a>
            {{ else }}
            <p class="text-sm leading-6 text-secondary font-normal m-0 line-clamp-3 overflow-hidden">{{ $description }}</p>
            {{ end }}
        </div>
        {{ if .code }}
            {{ with .code }}
                <div class="relative h-[19.3rem] py-5 px-7 bg-gray-900 text-white text-xs rounded-tl-[0.625rem] rounded-br-[0.625rem] scrollbar-custom code-container">
                    <pre class="bg-gray-900 m-0 py-0 pl-0 pr-5 whitespace-pre-wrap break-words text-left"><code class="text-xs block whitespace-pre-wrap leading-tight pl-0">{{ . }}</code></pre>
                    <button data-copy-code 
                            data-copied-text="{{ i18n "copy_success" | default "Copied!" }}"
                            data-copy-error-text="{{ i18n "copy_error" | default "Copy error" }}"
                            data-copy-default-text="{{ i18n "copy_code" | default "Copy code" }}"
                            class="absolute top-5 right-5 w-5 h-5 text-gray-500 hover:text-white cursor-pointer transition-colors duration-200" 
                            title="{{ i18n "copy_code" | default "Copy code" }}" 
                            aria-label="{{ i18n "copy_code" | default "Copy code" }}">
                        {{ partial "icons/tabler/copy" "w-5 h-5" }}
                    </button>
                </div>
                <script src="/js/copy-code.js"></script>
            {{ end }}
        {{ end }}
    </div>
</article>
{{/*
@component: Custom Video Player
@description: Component for custom (HTML5) videos with lazy loading and playback controls. Automatically uses CDN domain from staticAssets config.
@params:
  - src: Video URL (required, will be processed through get-static-url.html for CDN support)
  - title: Video title for accessibility (required)
  - alt: Alternative text for accessibility (optional, defaults to title)
  - class: Additional CSS classes (optional)
  - width: Video width (optional, default: "100%")
  - height: Video height (optional, default: "auto")
  - id: Optional ID attribute (optional)
  - autoplay: Enable autoplay (optional, default: false)
  - loop: Enable loop (optional, default: false)
  - muted: Enable muted (optional, default: false)
  - controls: Show video controls (optional, default: true)
  - controlsList: HTML5 controlslist attribute (optional, e.g. "nodownload")
  - poster: Poster image URL (optional, will be processed through get-static-url.html for CDN support)
  - useLightbox: Enable lightbox functionality (optional, default: false)
@note: This partial should be called through the main video.html partial, not directly.
*/}}

{{ $src := .src }}
{{ $title := .title | default "Video" }}
{{ $alt := .alt | default $title }}
{{ $class := .class | default "" }}
{{ $width := .width | default "100%" }}
{{ $height := .height | default "auto" }}
{{ $id := .id }}
{{ $autoplay := .autoplay | default false }}
{{ $loop := .loop | default false }}
{{ $muted := .muted | default false }}
{{ $controls := .controls | default true }}
{{ $controlsList := .controlsList | default "" }}
{{ $poster := .poster }}
{{ $posterUrl := "" }}
{{ $pureVideo := .pureVideo | default false }}

{{ $videoSrc := partial "functions/get-static-url.html" (dict "path" $src) }}

{{ if $pureVideo }}
  {{ $autoplay = true }}
  {{ $loop = true }}
  {{ $muted = true }}
{{ end }}

{{ if $poster }}
  {{ $posterUrl = partial "functions/get-static-url.html" (dict "path" $poster) }}
{{ end }}
{{ $useLightbox := .useLightbox | default true }}
{{ $showPlayOverlay := .showPlayOverlay | default true }}

{{ if not $pureVideo }}
<div 
  class="video-wrapper relative w-full overflow-hidden rounded-lg shadow-md {{ with $class }}{{ . }}{{ end }}" 
  data-video-provider="custom"
  data-video-lightbox="{{ if $useLightbox }}true{{ else }}false{{ end }}"
  data-video-title="{{ $title }}"
  data-video-src="{{ $videoSrc }}"
  {{ with $id }}id="{{ . }}"{{ end }}
>
{{ end }}
{{ if not $pureVideo }}
  <div class="video-aspect-ratio relative">
{{ end }}
    <video 
      {{ if $autoplay }}autoplay{{ end }}
      {{ if $loop }}loop{{ end }}
      {{ if $muted }}muted{{ end }}
      {{ if $controls }}controls{{ end }}
      {{ with $controlsList }}controlslist="{{ . }}"{{ end }}
      {{ with $posterUrl }}poster="{{ . }}"{{ end }}
      preload="metadata"
      class="{{ if $pureVideo }}{{ $class }}{{ else }}w-full h-full custom-video-player {{ if $useLightbox }}lightbox-ready{{ end }}{{ end }}"
      title="{{ $title }}"
      aria-label="{{ $alt }}"
      data-video-src="{{ $videoSrc }}"
      data-video-lightbox="{{ if $useLightbox }}true{{ else }}false{{ end }}"
    >
      <source src="{{ $videoSrc }}" type="{{ if in $src ".mp4" }}video/mp4{{ else if in $src ".webm" }}video/webm{{ else if in $src ".ogg" }}video/ogg{{ else }}video/mp4{{ end }}">
      <p>Your browser doesn't support HTML5 video. <a href="{{ $videoSrc }}">Download the video</a> instead.</p>
    </video>
{{ if not $pureVideo }}
      {{ if $showPlayOverlay }}
        <div class="video-play-overlay absolute inset-0 flex items-center justify-center pointer-events-none bg-gray-900 bg-opacity-50">
          <div class="video-play-button w-32 h-32 p-8 flex items-center justify-center bg-blue-600 bg-opacity-90 rounded-full text-white">
            {{ partial "icons/play-solid.html" (dict "class" "w-8 h-8") }}
          </div>
        </div>
      {{ end }}
  </div>
</div>
{{ end }}

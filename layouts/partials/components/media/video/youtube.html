{{/*
@component: YouTube Video Player
@description: Specialized component for YouTube videos with optimized lazy-loading and thumbnail preview.
@params:
  - videoID: YouTube video ID (required)
  - title: Video title for accessibility (required)
  - alt: Alternative text for accessibility (optional, defaults to title)
  - class: Additional CSS classes (optional)
  - width: Video width (optional, default: "100%")
  - height: Video height (optional, default: "auto")
  - id: Optional ID attribute (optional)
  - autoplay: Enable autoplay when opened in lightbox (optional, default: false)
  - poster: Custom poster/thumbnail image URL (optional, defaults to YouTube thumbnail)
  - posterHeight: Additional CSS classes for poster height (optional, e.g. "h-64", "h-80", "h-96", "h-[450px]")
  - useAspectRatio: Use 16:9 aspect ratio constraint (optional, default: true, adds 'aspect-ratio' class with height: 0; padding-bottom: 56.25%;)
  - playBtnClass: CSS classes for play button (optional)
  - playBtnInnerClass: CSS classes for inner play button element (optional)
  - showPlayButton: Show/hide play button overlay (optional, default: true)
@note: This partial should be called through the main video.html partial, not directly.
*/}}

{{ $videoID := .videoID }}
{{ $title := .title | default "YouTube Video" }}
{{ $alt := .alt | default $title }}
{{ $class := .class | default "" }}
{{ $width := .width | default "100%" }}
{{ $height := .height | default "auto" }}
{{ $id := .id }}
{{ $autoplay := .autoplay | default false }}
{{ $description := .description | default $title }}
{{ $uploadDate := .uploadDate | default (now.Format "2006-01-02T15:04:05Z07:00") }}
{{ $duration := .duration | default "PT0M0S" }}
{{ $noLazy := .noLazy | default false }}
{{ $poster := .poster }}
{{ $posterHeight := .posterHeight | default "" }}
{{ $useAspectRatio := .useAspectRatio | default true }}
{{ $loading := cond $noLazy "eager" "lazy" }}
{{ $playBtnClass := .playBtnClass | default "w-16 h-12 bg-red-600 rounded-lg hover:bg-red-700 hover:scale-110" }}
{{ $playBtnInnerClass := .playBtnInnerClass | default "" }}
{{ $svgClass := .svgClass | default "size-6 text-white ml-1" }}
{{ $showPlayButton := .showPlayButton | default true }}

<!-- Determine thumbnail URL: use custom poster if provided, otherwise use YouTube default -->
{{ $thumbnailUrl := cond $poster $poster (print "https://img.youtube.com/vi/" $videoID "/maxresdefault.jpg") }}

<!-- Schema.org VideoObject metadata for SEO -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "VideoObject",
  "name": {{ $title }},
  "description": {{ $description }},
  "thumbnailUrl": {{ $thumbnailUrl }},
  "uploadDate": {{ $uploadDate }},
  "duration": {{ $duration }},
  "contentUrl": "https://www.youtube.com/watch?v={{ $videoID }}",
  "embedUrl": "https://www.youtube.com/embed/{{ $videoID }}"
}
</script>

<div 
  class="relative w-full overflow-hidden rounded-lg shadow-md {{ with $class }}{{ . }}{{ end }}"
  data-video-id="{{ $videoID }}"
  data-video-title="{{ $title }}"
  data-video-provider="youtube"
  data-video-width="{{ $width }}"
  data-video-height="{{ $height }}"
  data-video-autoplay="{{ $autoplay }}"
  data-video-use-lightbox="true"
  data-video-fallback-url="https://www.youtube.com/watch?v={{ $videoID }}"
  {{ with $id }}id="{{ . }}"{{ end }}
>
  {{/* Build thumbnail class string for maintainability */}}
  {{ $thumbnailClass := "lazy-video-thumbnail" }}
  {{ if $useAspectRatio }}
    {{ $thumbnailClass = printf "%s aspect-ratio video-aspect-ratio" $thumbnailClass }}
  {{ else }}
    {{ $thumbnailClass = printf "%s min-h-[35rem]" $thumbnailClass }}
  {{ end }}
  {{ $thumbnailClass = printf "%s relative w-full overflow-hidden cursor-pointer" $thumbnailClass }}
  {{ if $posterHeight }}
    {{ $thumbnailClass = printf "%s %s" $thumbnailClass $posterHeight }}
  {{ end }}
  <div class="{{ $thumbnailClass }}" data-video-trigger="true">
    <img 
      src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 9'%3E%3C/svg%3E"
      data-src="{{ $thumbnailUrl }}"
      alt="Thumbnail for {{ $alt }}"
      class="lazy-video-thumb-img lazy-image absolute inset-0 w-full h-full object-cover transition-transform duration-300"
      {{ if not $poster }}data-video-id="{{ $videoID }}"{{ end }}
      loading="{{ $loading }}"
      decoding="async"
      width="{{ $width }}"
      height="{{ $height }}"
      {{ if not $poster }}onload="this.onload=null; if(this.dataset.src === this.src) findBestThumbnail(this);"{{ end }}
    />
  </div>
  {{ if $showPlayButton }}
  <div class="lazy-video-play-button absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 flex items-center justify-center transition-all duration-300 z-10 {{ $playBtnClass }}">
    {{ if $playBtnInnerClass }}
      <div class="{{ $playBtnInnerClass }}">
        {{ partial "icons/play-solid" $svgClass }}
      </div>
    {{ else }}
      {{ partial "icons/play-solid" $svgClass }}
    {{ end }}
  </div>
  {{ end }}
</div>

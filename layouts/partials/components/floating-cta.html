{{/*
@component: Floating CTA
@description: A floating call-to-action element that sticks to the right side of blog content.
              Floats next to content, stays sticky while scrolling, and stops when reaching the FAQ section.
              Supports both dark and light themes with optional background image.
@params:
  Page-level (front matter):
  - floatingCta.heading: CTA heading text
  - floatingCta.description: CTA description text
  - floatingCta.buttonText: CTA button text
  - floatingCta.buttonUrl: CTA button URL
  - floatingCta.buttonVariant: Button style variant (primary, secondary, primary-alternate)
  - floatingCta.image: CTA image path (displayed in content area)
  - floatingCta.imageAlt: CTA image alt text
  - floatingCta.backgroundImage: Background image path (displayed at bottom of CTA)
  - floatingCta.badge: Badge text (optional)
  - floatingCta.features: Array of feature strings (optional)
  - floatingCta.secondaryText: Secondary link text (optional)
  - floatingCta.secondaryUrl: Secondary link URL (optional)
  - floatingCta.theme: Theme variant - "dark" (default) or "light"
  - floatingCta.showLogo: Show logo at top (optional, default: false)

  Site-level (params.toml):
  - floatingCta.heading: Default heading
  - floatingCta.description: Default description
  - floatingCta.buttonText: Default button text
  - floatingCta.buttonUrl: Default button URL
  - floatingCta.buttonVariant: Default button variant (defaults to "primary")
  - floatingCta.image: Default image
  - floatingCta.imageAlt: Default image alt text
  - floatingCta.backgroundImage: Default background image
  - floatingCta.badge: Default badge text
  - floatingCta.features: Default features array
  - floatingCta.secondaryText: Default secondary link text
  - floatingCta.secondaryUrl: Default secondary link URL
  - floatingCta.theme: Default theme variant
  - floatingCta.showLogo: Default show logo setting
  - floatingCta.enable: Enable/disable floating CTA globally
@example:
  {{ partial "components/floating-cta.html" . }}
*/}}

{{/* Check if floating CTA is enabled globally (Hugo lowercases config keys) */}}
{{ $globalEnable := site.Params.floatingcta.enable | default true }}

{{/* Check if this page explicitly disables the floating CTA */}}
{{ $pageDisable := .Params.floatingCtaDisable | default false }}

{{/* Only render if enabled globally and not disabled on this page */}}
{{ if and $globalEnable (not $pageDisable) }}

{{/* Get page-level settings with site-level fallbacks (Hugo lowercases config keys) */}}
{{/* Theme defaults are generic placeholders - override in site config or page front matter */}}
{{ $heading := .Params.floatingCta.heading | default site.Params.floatingcta.heading | default (i18n "floating_cta_heading") | default "Get Started Today" }}
{{ $description := .Params.floatingCta.description | default site.Params.floatingcta.description | default (i18n "floating_cta_description") | default "Start your journey with our platform. Easy setup, powerful features." }}
{{ $buttonText := .Params.floatingCta.buttonText | default site.Params.floatingcta.buttontext | default (i18n "floating_cta_button") | default "Get Started" }}
{{ $buttonUrl := .Params.floatingCta.buttonUrl | default site.Params.floatingcta.buttonurl | default "/contact/" }}
{{ $buttonVariant := .Params.floatingCta.buttonVariant | default site.Params.floatingcta.buttonvariant | default "primary" }}
{{ $image := .Params.floatingCta.image | default site.Params.floatingcta.image | default "" }}
{{ $imageAlt := .Params.floatingCta.imageAlt | default site.Params.floatingcta.imagealt | default $heading }}
{{ $backgroundImage := .Params.floatingCta.backgroundImage | default site.Params.floatingcta.backgroundimage | default "" }}
{{ $badge := .Params.floatingCta.badge | default site.Params.floatingcta.badge | default "" }}
{{ $secondaryText := .Params.floatingCta.secondaryText | default site.Params.floatingcta.secondarytext | default "" }}
{{ $secondaryUrl := .Params.floatingCta.secondaryUrl | default site.Params.floatingcta.secondaryurl | default "" }}
{{ $theme := .Params.floatingCta.theme | default site.Params.floatingcta.theme | default "dark" }}
{{ $showLogo := .Params.floatingCta.showLogo | default site.Params.floatingcta.showlogo | default false }}

{{/* Default features if not specified - empty by default, configure in site params */}}
{{ $defaultFeatures := slice }}
{{ $features := .Params.floatingCta.features | default site.Params.floatingcta.features | default $defaultFeatures }}

{{/* Determine theme classes */}}
{{ $themeClass := "floating-cta--dark" }}
{{ if eq $theme "light" }}
  {{ $themeClass = "floating-cta--light" }}
{{ end }}

{{/* Calculate if we need extra padding for background image */}}
{{ $hasBackgroundImage := ne $backgroundImage "" }}

{{/* Translate URLs if needed */}}
{{ $buttonUrl = partial "helpers/get-translated-url.html" (dict "url" $buttonUrl "lang" site.Language.Lang) }}
{{ $secondaryUrl = partial "helpers/get-translated-url.html" (dict "url" $secondaryUrl "lang" site.Language.Lang) }}

<aside class="floating-cta {{ $themeClass }}{{ if $hasBackgroundImage }} floating-cta--has-bg{{ end }}" aria-label="Call to action">
  <div class="floating-cta__inner">
    {{/* Accent bar - only show for dark theme without background image */}}
    {{ if and (eq $theme "dark") (not $hasBackgroundImage) }}
    <div class="floating-cta__accent"></div>
    {{ end }}

    {{/* Content */}}
    <div class="floating-cta__content">
      {{/* Logo - optional */}}
      {{ if $showLogo }}
      <div class="floating-cta__logo">
        {{ partialCached "header/logo_section" (dict
          "logoUrl" (site.Params.logo | default "/images/logo.svg")
          "logoAlt" site.Title
          "logoHeight" "h-8"
          "siteTitle" site.Title
          "class" "inline-block"
        ) "floating-cta-logo" }}
      </div>
      {{ end }}

      {{/* Badge */}}
      {{ if $badge }}
      <div class="floating-cta__badge">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" />
        </svg>
        {{ $badge }}
      </div>
      {{ end }}

      <h3 class="floating-cta__heading">{{ $heading }}</h3>

      {{/* Image between title and description */}}
      {{ if $image }}
      <div class="floating-cta__image">
        {{ partial "components/media/lazyimg.html" (dict
          "src" $image
          "alt" $imageAlt
          "maxWidth" 280
        ) }}
      </div>
      {{ end }}

      <p class="floating-cta__description">{{ $description }}</p>

      {{/* Feature list */}}
      {{ if $features }}
      <ul class="floating-cta__features">
        {{ range $features }}
        <li class="floating-cta__feature">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
          </svg>
          {{ . }}
        </li>
        {{ end }}
      </ul>
      {{ end }}
    </div>

    {{/* Button */}}
    <div class="floating-cta__action">
      {{ partial "components/buttons/buttons.html" (dict
        "text" $buttonText
        "url" $buttonUrl
        "variant" $buttonVariant
        "size" "lg"
        "classes" "w-full justify-center"
      ) }}

      {{/* Secondary link */}}
      {{ if and $secondaryText $secondaryUrl }}
      <div class="floating-cta__secondary">
        <a href="{{ $secondaryUrl }}">{{ $secondaryText }} â†’</a>
      </div>
      {{ end }}
    </div>

    {{/* Background image - displayed at bottom */}}
    {{ if $hasBackgroundImage }}
    <div class="floating-cta__bg-image">
      {{ partial "components/media/lazyimg.html" (dict
        "src" $backgroundImage
        "alt" ""
        "class" "floating-cta__bg-img"
        "maxWidth" 340
      ) }}
    </div>
    {{ end }}
  </div>
</aside>

{{ end }}

{{/* Search Field Partial */}}
{{- $searchId := .type | default "header-desktop-search" -}}
{{- $marginClass := .marginClass | default "" -}}
{{- $context := .context | default . -}}
{{- $directories := .directories | default (slice) -}}
{{- $placeholder := .placeholder | default (i18n "search_placeholder") -}}
{{- $resultsContainer := .resultsContainer | default "" -}}
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js" integrity="sha512-Nqw1tH3mpavka9cQCc5zWWEZNfIPdOYyQFjlV1NvflEtQ0/XI6ZQ+H/D3YgJdqSUJlMLAPRj/oXlaHCFbFCjoQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>

<div class="w-full h-full {{ $marginClass }} relative">
    <div class="relative w-full">
        <input type="text" id="popup-search-input-{{ $searchId }}" class="hide-search-clear w-full pl-3 pr-9 py-1.5 text-sm border border-gray-primary rounded-md surface-primary placeholder:text-placeholder focus:outline-none focus:ring-2 focus:ring-primary transition" placeholder="{{ $placeholder }}" aria-label="{{ $placeholder }}">
        <button type="button" id="clear-search-{{ $searchId }}" class="absolute right-2 top-1/2 -translate-y-1/2 hidden p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors" aria-label="{{ i18n "search_clear_aria" }}" title="{{ i18n "search_clear_title" }}">
            {{ partial "icons/x-mark" "w-4 h-4 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300" }}
        </button>
    </div>
    <div id="search-results-popup-{{ $searchId }}" class="absolute top-full left-0 right-0 mt-2 max-h-[500px] overflow-y-auto bg-white dark:bg-gray-900 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 z-[9999] hidden">
        <div id="popup-search-results-{{ $searchId }}" class="p-2"></div>
        <div class="search-loading-{{ $searchId }} text-center px-3 py-4 text-secondary hidden">{{ i18n "search_loading" }}</div>
        <div class="search-view-all-{{ $searchId }} text-center py-3 border-t border-gray-200 dark:border-gray-700 hidden">
            <a href="/search/" id="view-all-results-{{ $searchId }}" class="text-heading text-sm font-medium hover:underline hover:text-primary">{{ i18n "search_view_all_results" }}</a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Translation strings
    const searchTranslations = {
        searchNotAvailable: {{ i18n "search_not_available" | jsonify | safeJS }},
        searchInitializing: {{ i18n "search_initializing" | jsonify | safeJS }},
        searchErrorLoading: {{ i18n "search_error_loading" | jsonify | safeJS }},
        searchErrorPerforming: {{ i18n "search_error_performing" | jsonify | safeJS }},
        searchNoResults: {{ i18n "search_no_results" | jsonify | safeJS }},
        searchNoResultsDescription: {{ i18n "search_no_results_description" | jsonify | safeJS }},
        searchNoContentPreview: {{ i18n "search_no_content_preview" | jsonify | safeJS }},
        searchUntitled: {{ i18n "search_untitled" | jsonify | safeJS }},
        searchResultsFound: {{ i18n "search_results_found" | jsonify | safeJS }},
        searchResultsFoundPlural: {{ i18n "search_results_found_plural" | jsonify | safeJS }}
    };

    // Make sure the required libraries are available
    if (typeof Fuse === 'undefined') {
        console.warn('Fuse.js is not loaded. Search functionality will be limited.');
    }

    if (typeof Mark === 'undefined') {
        console.warn('Mark.js is not loaded. Highlighting will be disabled.');
    }

    // DOM Elements
    const searchInput = document.getElementById('popup-search-input-{{ $searchId }}');
    const searchResultsPopup = document.getElementById('search-results-popup-{{ $searchId }}');
    const searchResults = document.getElementById('popup-search-results-{{ $searchId }}');
    const loadingIndicator = document.querySelector('.search-loading-{{ $searchId }}');
    const viewAllSection = document.querySelector('.search-view-all-{{ $searchId }}');
    const viewAllLink = document.getElementById('view-all-results-{{ $searchId }}');
    const clearButton = document.getElementById('clear-search-{{ $searchId }}');

    // Global variables
    let fuseInstance = null;
    let debounceTimer;
    let searchData = null;
    let originalSearchData = null;
    let isSearchInitialized = false;
    let selectedResultIndex = -1;
    const directories = {{ $directories | jsonify | safeJS }};
    const resultsContainer = {{ $resultsContainer | jsonify | safeJS }};

    // --- Event Listeners ---

    // Close popup when clicking outside
    document.addEventListener('click', function(event) {
        if (!searchInput.contains(event.target) && !searchResultsPopup.contains(event.target)) {
            searchResultsPopup.classList.add('hidden');
        }
    });

    // Keyboard navigation
    searchInput.addEventListener('keydown', function(event) {
        const isPopupVisible = !searchResultsPopup.classList.contains('hidden');

        // Close popup on Escape key
        if (event.key === 'Escape' && isPopupVisible) {
            searchResultsPopup.classList.add('hidden');
            searchInput.blur();
            selectedResultIndex = -1;
            return;
        }

        if (!isPopupVisible) return;

        const resultItems = searchResults.querySelectorAll('a[href]');

        if (resultItems.length === 0) return;

        // Arrow Down: Move selection down
        if (event.key === 'ArrowDown') {
            event.preventDefault();
            selectedResultIndex = (selectedResultIndex + 1) % resultItems.length;
            updateSelectedResult(resultItems);
        }

        // Arrow Up: Move selection up
        else if (event.key === 'ArrowUp') {
            event.preventDefault();
            selectedResultIndex = selectedResultIndex <= 0 ? resultItems.length - 1 : selectedResultIndex - 1;
            updateSelectedResult(resultItems);
        }

        // Enter: Navigate to selected result
        else if (event.key === 'Enter' && selectedResultIndex >= 0) {
            event.preventDefault();
            if (resultItems[selectedResultIndex]) {
                window.location.href = resultItems[selectedResultIndex].getAttribute('href');
            }
        }
    });

    // Helper function to update visual selection
    function updateSelectedResult(resultItems) {
        resultItems.forEach((item, index) => {
            const parent = item.closest('div[class*="p-3"]') || item.closest('a[class*="block"]');
            if (parent) {
                if (index === selectedResultIndex) {
                    // Strong visual selection with blue background and border
                    parent.style.backgroundColor = '#dbeafe';
                    parent.style.borderColor = '#3b82f6';
                    parent.style.borderWidth = '2px';
                    parent.style.boxShadow = '0 0 0 3px rgba(59, 130, 246, 0.1)';
                    parent.style.transform = 'scale(1.02)';
                    parent.style.transition = 'all 0.15s ease';
                    parent.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                } else {
                    parent.style.backgroundColor = '';
                    parent.style.borderColor = '';
                    parent.style.borderWidth = '';
                    parent.style.boxShadow = '';
                    parent.style.transform = '';
                    parent.style.transition = '';
                }
            }
        });
    }

    // Clear search functionality
    clearButton.addEventListener('click', function() {
        searchInput.value = '';
        searchResultsPopup.classList.add('hidden');
        clearButton.classList.add('hidden');
        searchInput.focus();

        // Restore original content and show alphabet nav (for FAQ/glossary pages)
        if (resultsContainer) {
            const container = document.getElementById(resultsContainer);
            if (container && container.hasAttribute('data-original-content')) {
                container.innerHTML = container.getAttribute('data-original-content');
            }
            const alphabetNav = document.getElementById('alphabetNav');
            if (alphabetNav) alphabetNav.style.display = '';
        }
    });

    // Show/hide clear button based on input content
    function toggleClearButton() {
        if (searchInput.value.trim().length > 0) {
            clearButton.classList.remove('hidden');
        } else {
            clearButton.classList.add('hidden');
        }
    }

    // Initialize search only when user interacts with the search input
    searchInput.addEventListener('focus', initializeSearch);

    // Handle input changes
    searchInput.addEventListener('input', function() {
        toggleClearButton();
        clearTimeout(debounceTimer);

        const query = this.value.trim();

        if (query.length < 2) {
            searchResultsPopup.classList.add('hidden');
            // Restore original content when query is cleared (for FAQ/glossary pages)
            if (resultsContainer) {
                const container = document.getElementById(resultsContainer);
                if (container && container.hasAttribute('data-original-content')) {
                    container.innerHTML = container.getAttribute('data-original-content');
                }
                const alphabetNav = document.getElementById('alphabetNav');
                if (alphabetNav) alphabetNav.style.display = '';
            }
            return;
        }

        debounceTimer = setTimeout(() => performSearch(query), 300);
    });

    // --- Search Functions ---

    /**
     * Initializes the search mechanism (Fuse.js) by loading the index.
     * Loads data only once.
     */
    function initializeSearch() {
        if (typeof Fuse === 'undefined') {
            searchResults.innerHTML = `<p>${searchTranslations.searchNotAvailable}</p>`;
            searchResultsPopup.classList.remove('hidden');
            return;
        }

        if (isSearchInitialized) {
            return;
        }

        loadingIndicator.classList.remove('hidden');
        searchResultsPopup.classList.remove('hidden');
        searchResults.innerHTML = `<p>${searchTranslations.searchInitializing}</p>`;

        fetch('/index.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (!data || !Array.isArray(data) || data.length === 0) {
                    console.error('Search index is empty or invalid:', data);
                    throw new Error('Search index is empty or invalid');
                }

                originalSearchData = data;
                
                // Filter by directories if specified
                if (directories && directories.length > 0) {
                    searchData = data.filter(item => {
                        if (!item.dir) return false;
                        return directories.some(dir => item.dir === dir || item.dir.startsWith(dir + '/'));
                    });
                } else {
                    searchData = data;
                }

                fuseInstance = new Fuse(searchData, {
                    keys: [
                        { name: 'title', weight: 2 },
                        { name: 'content', weight: 1 },
                        { name: 'tags', weight: 1.5 }
                    ],
                    includeScore: true,
                    includeMatches: true,
                    minMatchCharLength: 2,
                    threshold: 0.2,
                    ignoreLocation: true,
                    distance: 200
                });

                isSearchInitialized = true;
                loadingIndicator.classList.add('hidden');

                const query = searchInput.value.trim();
                if (query.length >= 2) {
                    performSearch(query);
                } else {
                    searchResultsPopup.classList.add('hidden');
                }
            })
            .catch(error => {
                console.error('Search Initialization Error:', error);
                loadingIndicator.classList.add('hidden');
                searchResults.innerHTML = `<p>${searchTranslations.searchErrorLoading}</p>`;
                searchResultsPopup.classList.remove('hidden');
                isSearchInitialized = false;
            });
    }

    /**
     * Prioritizes search results based on exact phrase matches and word presence
     * @param {Array} results - Fuse.js search results
     * @param {string} query - The search query
     * @returns {Array} Sorted results with exact matches first
     */
    function prioritizeResults(results, query) {
        const lowerQuery = query.toLowerCase().trim();
        const queryWords = lowerQuery.split(/\s+/).filter(w => w.length > 0);

        return results.map(result => {
            const item = result.item;
            const title = (item.title || '').toLowerCase();
            const content = (item.content || '').toLowerCase();
            const tags = Array.isArray(item.tags) ? item.tags.join(' ').toLowerCase() : '';
            const fullText = `${title} ${content} ${tags}`;

            // Calculate priority score (lower is better)
            let priorityScore = result.score || 0;

            // Boost 1: Exact phrase match in title (highest priority)
            if (title.includes(lowerQuery)) {
                priorityScore -= 1000;
            }

            // Boost 2: Exact phrase match in content
            if (content.includes(lowerQuery)) {
                priorityScore -= 500;
            }

            // Boost 3: All words present
            if (queryWords.length > 1) {
                const wordsPresent = queryWords.filter(word => fullText.includes(word)).length;
                const wordRatio = wordsPresent / queryWords.length;
                priorityScore -= wordRatio * 100;
            }

            return {
                ...result,
                priorityScore
            };
        }).sort((a, b) => a.priorityScore - b.priorityScore);
    }

    /**
     * Performs a search for the given query and displays the results.
     * @param {string} query - The search query.
     */
    function performSearch(query) {
        if (!fuseInstance) {
            searchResults.innerHTML = `<p>${searchTranslations.searchInitializing}</p>`;
            return;
        }

        try {
            // Perform multi-token search: search for whole phrase AND individual words
            let results = fuseInstance.search(query);

            // If query has multiple words, also search for individual words
            const queryWords = query.trim().split(/\s+/).filter(w => w.length >= 2);
            if (queryWords.length > 1) {
                // Search for each word individually and merge results
                const wordResults = [];
                queryWords.forEach(word => {
                    const wordMatches = fuseInstance.search(word);
                    wordResults.push(...wordMatches);
                });

                // Merge results, avoiding duplicates
                const seenPermalinks = new Set(results.map(r => r.item.permalink));
                wordResults.forEach(result => {
                    if (!seenPermalinks.has(result.item.permalink)) {
                        results.push(result);
                        seenPermalinks.add(result.item.permalink);
                    }
                });
            }

            // Prioritize exact matches and multi-word presence
            results = prioritizeResults(results, query);

            // Reset keyboard selection when new results appear
            selectedResultIndex = -1;

            // If we have a custom results container, display results there
            if (resultsContainer) {
                displayResultsInContainer(results, query);
                return;
            }

            loadingIndicator.classList.add('hidden');
            searchResultsPopup.classList.remove('hidden');

            viewAllLink.href = `/search?q=${encodeURIComponent(query)}`;

            if (results.length > 0) {
                const displayResults = results.slice(0, 5);
                let html = '';

                displayResults.forEach(({ item, matches }, index) => {
                    let snippet = searchTranslations.searchNoContentPreview;

                    if (item && typeof item.content === 'string' && item.content.trim().length > 0) {
                        snippet = item.content.substring(0, Math.min(item.content.length, 80)) + '...';

                        if (matches && Array.isArray(matches)) {
                            const contentMatch = matches.find(m => m && m.key === 'content' && Array.isArray(m.indices) && m.indices.length > 0);

                            if (contentMatch && contentMatch.indices && contentMatch.indices.length > 0) {
                                const [matchStart, matchEnd] = contentMatch.indices[0];
                                const contextLength = 40;

                                const start = Math.max(0, matchStart - contextLength);
                                const end = Math.min(item.content.length, matchEnd + contextLength);

                                snippet = (start > 0 ? '...' : '') +
                                          item.content.substring(start, end) +
                                          (end < item.content.length ? '...' : '');
                            }
                        }
                    }

                    const title = item.title || searchTranslations.searchUntitled;
                    const permalink = item.permalink || '#';

                    const isLast = index === displayResults.length - 1;
                    const borderClass = 'border border-gray-200 dark:border-gray-700 rounded-md shadow-sm';
                    const marginClass = isLast ? '' : 'mb-3';

                    html += `
                    <div class="p-3 surface-secondary ${borderClass} ${marginClass}">
                        <a href="${permalink}" class="no-underline text-inherit group/dropdown-item">
                            <div class="font-semibold text-heading mb-1.5 group-hover/dropdown-item:text-primary">${title}</div>
                            <div class="text-sm text-secondary">${snippet}</div>
                        </a>
                    </div>`;
                });

                searchResults.innerHTML = html;
                viewAllSection.classList.toggle('hidden', results.length <= 5);

                if (typeof Mark !== 'undefined' && searchResults.children.length > 0) {
                    const markInstance = new Mark(searchResults);
                    markInstance.mark(query, {
                        element: 'mark',
                        className: 'text-primary surface-brand-secondary'
                    });
                }
            } else {
                searchResults.innerHTML = `
                    <div class="flex flex-col items-center justify-center text-center p-6">
                        {{ partial "icons/face-frown" "w-11 h-11 icon-on-gray" }}
                        <p class="mt-3 text-sm font-semibold text-heading">${searchTranslations.searchNoResults}</p>
                        <p class="mt-1 text-sm text-tertiary">${searchTranslations.searchNoResultsDescription}</p>
                    </div>
                `;
                viewAllSection.classList.add('hidden');
            }
        } catch (error) {
            console.error('Search execution error:', error);
            searchResults.innerHTML = `<p>${searchTranslations.searchErrorPerforming}</p>`;
            searchResultsPopup.classList.remove('hidden');
        }
    }
    
    /**
     * Display search results in a custom container (for page-specific search) or in a popup
     */
    function displayResultsInContainer(results, query) {
        const container = document.getElementById(resultsContainer);
        
        // If no container is specified or it doesn't exist, show results in popup
        if (!container) {
            displayResultsInPopup(results, query);
            return;
        }
        
        // Store original content on first search
        if (!container.hasAttribute('data-original-content')) {
            container.setAttribute('data-original-content', container.innerHTML);
        }

        // Hide alphabet navigation when searching (for FAQ/glossary pages)
        const alphabetNav = document.getElementById('alphabetNav');

        if (query.length < 2) {
            // Restore original content
            container.innerHTML = container.getAttribute('data-original-content');
            // Show alphabet nav again
            if (alphabetNav) alphabetNav.style.display = '';
            return;
        }

        // Hide alphabet nav during search
        if (alphabetNav) alphabetNav.style.display = 'none';
        
        if (results.length === 0) {
            container.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <p class="text-lg text-gray-500">${searchTranslations.searchNoResults}</p>
                    <p class="mt-2 text-sm text-gray-400">${searchTranslations.searchNoResultsDescription}</p>
                </div>
            `;
            return;
        }
        
        // Filter out duplicates based on permalink
        const uniqueResults = [];
        const seenPermalinks = new Set();

        for (const result of results) {
            if (!seenPermalinks.has(result.item.permalink)) {
                uniqueResults.push(result);
                seenPermalinks.add(result.item.permalink);
            }
        }

        // Build search results HTML - completely replace container content
        const resultsHTML = uniqueResults.map(result => {
            const item = result.item;
            return createResultCard(item);
        }).join('');

        const resultText = uniqueResults.length === 1
            ? searchTranslations.searchResultsFound.replace('%d', uniqueResults.length).replace('%s', `"${query}"`)
            : searchTranslations.searchResultsFoundPlural.replace('%d', uniqueResults.length).replace('%s', `"${query}"`);

        container.innerHTML = `
            <div class="wrapper mt-10">
                <div class="search-info mb-4">
                    <p class="text-sm text-gray-600">${resultText}</p>
                </div>
                <ul class="grid gap-10 sm:grid-cols-2 lg:grid-cols-3">
                    ${resultsHTML}
                </ul>
            </div>
        `;
    }
    
    /**
     * Display search results in a popup (for hero search)
     */
    function displayResultsInPopup(results, query) {
        loadingIndicator.classList.add('hidden');
        searchResultsPopup.classList.remove('hidden');
        
        viewAllLink.href = `/search?q=${encodeURIComponent(query)}`;
        
        if (results.length > 0) {
            // Filter out duplicates based on permalink
            const uniqueResults = [];
            const seenPermalinks = new Set();
            
            for (const result of results) {
                if (!seenPermalinks.has(result.item.permalink)) {
                    uniqueResults.push(result);
                    seenPermalinks.add(result.item.permalink);
                }
            }
            
            const displayResults = uniqueResults.slice(0, 5);
            let html = '';
            
            displayResults.forEach(({ item, matches }, index) => {
                const title = item.title || searchTranslations.searchUntitled;
                const permalink = item.permalink || '#';
                const imageUrl = item.image || '';
                
                let snippet = searchTranslations.searchNoContentPreview;
                if (item && typeof item.content === 'string' && item.content.trim().length > 0) {
                    snippet = item.content.substring(0, Math.min(item.content.length, 120)) + '...';
                }
                
                const isLast = index === displayResults.length - 1;
                
                html += `
                <a href="${permalink}" class="block px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors ${!isLast ? 'border-b border-gray-100 dark:border-gray-800' : ''}">
                    <div class="flex items-start gap-3">
                        ${imageUrl ? `
                        <div class="flex-shrink-0 w-10 h-10 bg-gray-100 dark:bg-gray-800 rounded-md flex items-center justify-center overflow-hidden">
                            <img src="${imageUrl}" alt="${title}" class="w-full h-full object-contain p-1" loading="lazy">
                        </div>
                        ` : ''}
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-gray-900 dark:text-gray-100 text-sm mb-1 truncate">${title}</div>
                            <div class="text-xs text-gray-600 dark:text-gray-400 line-clamp-2">${snippet}</div>
                        </div>
                    </div>
                </a>`;
            });
            
            searchResults.innerHTML = html;
            viewAllSection.classList.toggle('hidden', uniqueResults.length <= 5);
            
            if (typeof Mark !== 'undefined' && searchResults.children.length > 0) {
                const markInstance = new Mark(searchResults);
                markInstance.mark(query, {
                    element: 'mark',
                    className: 'text-primary surface-brand-secondary'
                });
            }
        } else {
            searchResults.innerHTML = `
                <div class="flex flex-col items-center justify-center text-center py-8 px-4">
                    <svg class="w-12 h-12 text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <p class="text-sm font-medium text-gray-900 dark:text-gray-100">${searchTranslations.searchNoResults}</p>
                    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">${searchTranslations.searchNoResultsDescription}</p>
                </div>
            `;
            viewAllSection.classList.add('hidden');
        }
    }
    
    /**
     * Create result card matching existing design (for grid layouts)
     */
    function createResultCard(item) {
        const truncatedContent = item.content ?
            item.content.substring(0, 160) + '...' : '';

        // Show light-bulb icon for FAQ pages
        const isFaq = directories && directories.includes('faq');
        const iconHtml = isFaq ? `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5 text-gray-900 shrink-0" fill="none"><path d="M12 18V12.75M12 12.75C12.5179 12.75 13.0206 12.6844 13.5 12.561M12 12.75C11.4821 12.75 10.9794 12.6844 10.5 12.561M14.25 20.0394C13.5212 20.1777 12.769 20.25 12 20.25C11.231 20.25 10.4788 20.1777 9.75 20.0394M13.5 22.422C13.007 22.4736 12.5066 22.5 12 22.5C11.4934 22.5 10.993 22.4736 10.5 22.422M14.25 18V17.8083C14.25 16.8254 14.9083 15.985 15.7585 15.4917C17.9955 14.1938 19.5 11.7726 19.5 9C19.5 4.85786 16.1421 1.5 12 1.5C7.85786 1.5 4.5 4.85786 4.5 9C4.5 11.7726 6.00446 14.1938 8.24155 15.4917C9.09173 15.985 9.75 16.8254 9.75 17.8083V18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>` : '';

        return `
            <li>
                <article class="group relative rounded-2xl flex flex-col surface-secondary shadow-lg border border-gray-primary overflow-hidden transition-transform duration-300 ease-in-out hover:-translate-y-1 h-full min-h-[15.75rem]">
                    <a href="${item.permalink}" class="absolute inset-0" aria-label="Read more: ${item.title}">
                        <span class="sr-only">${item.title}</span>
                    </a>
                    <div class="flex flex-col flex-grow p-8 items-start text-left">
                        ${isFaq ? `<div class="mb-2">${iconHtml}</div>` : ''}
                        <h3 class="text-lg/6 font-semibold text-heading group-hover:text-tertiary transition-colors duration-300">
                            ${item.title}
                        </h3>
                        <p class="mt-5 text-sm leading-6 text-secondary font-normal line-clamp-3 flex-grow overflow-hidden">${truncatedContent}</p>
                    </div>
                </article>
            </li>
        `;
    }
});
</script>
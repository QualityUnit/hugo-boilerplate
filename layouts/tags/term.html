{{ define "main" }}
{{ partial "breadcrumbs_default.html" . }}

{{ $partialParams := dict
  "title" .Title
}}

<!-- Tag Posts List -->
<div class="surface-primary py-16">
  <div class="wrapper px-6 lg:px-8">
    <h1 class="text-7xl font-semibold tracking-tight text-heading">{{ .Title }}</h1>

    {{ partial "search_field.html" . }}

    {{ $paginator := .Paginate .Pages 3 }}
      
    {{ if eq $paginator.TotalPages 0 }}
      <div class="text-center py-12">
        <h3 class="text-lg font-medium text-heading">{{ i18n "tag_no_content_found" }}</h3>
        <p class="mt-2 text-sm text-muted">{{ i18n "tag_try_browsing" }}</p>
      </div>
    {{ else }}
      <div class="mt-8 grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
        {{ range $paginator.Pages }}
          {{ partial "components/cards/post_card_with_image.html" (dict "page" . ) }}
        {{ end }}
      </div>
      
      <!-- Pagination -->
      {{ if gt $paginator.TotalPages 1 }}
        {{partial "components/pagination/pagination.html" $paginator }}
      {{ end }}
    {{ end }}
  </div>
</div>

<!-- Related Tags Section -->
<div class="bg-gray-50 py-12">
  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <div class="mx-auto max-w-2xl lg:max-w-4xl">
      <h2 class="text-2xl font-bold tracking-tight text-gray-900">{{ i18n "tag_other_tags" }}</h2>
      <div class="mt-6 flex flex-wrap gap-3">
        {{ $currentTag := .Title }}
        {{ $tags := $.Site.Taxonomies.tags }}
        {{ $relatedTags := slice }}
        
        {{ range $name, $taxonomy := $tags }}
          {{ if ne $name $currentTag }}
            {{ $relatedTags = $relatedTags | append (dict "name" $name "count" (len $taxonomy.Pages)) }}
          {{ end }}
        {{ end }}
        
        {{ range first 100 (sort $relatedTags "count" "desc") }}
          <a href="{{ "/tags/" | relLangURL }}{{ .name | urlize }}/" class="inline-flex items-center rounded-full bg-gray-100 px-3 py-1.5 text-sm font-medium text-gray-800 hover:bg-gray-200">
            {{ .name }} <span class="ml-1.5 text-xs text-gray-500">({{ .count }})</span>
          </a>
        {{ end }}
      </div>
    </div>
  </div>
</div>

{{ end }}

{{ define "main" }}

{{ partial "hero_default.html" . }}

{{ if eq (len .Pages) 0 }}
  <div class="wrapper text-center">
    <p class="text-xl font-semibold ">{{ i18n "no_posts_found" }}</p>
  </div>
{{ else }}

  {{/* Determine sorting method from page params */}}
  {{ $sortBy := .Params.sortBy | default "title" }}
  {{ $sortOrder := .Params.sortOrder | default "asc" }}
  
  {{/* For date sorting, default to desc (newest first) */}}
  {{ if eq $sortBy "date" }}
    {{ $sortOrder = .Params.sortOrder | default "desc" }}
  {{ end }}
  
  {{/* Apply sorting based on parameters */}}
  {{ $pages := .Pages }}
  {{ if eq $sortBy "date" }}
    {{ if eq $sortOrder "desc" }}
      {{ $pages = .Pages.ByDate.Reverse }}
    {{ else }}
      {{ $pages = .Pages.ByDate }}
    {{ end }}
  {{ else if eq $sortBy "title" }}
    {{ if eq $sortOrder "desc" }}
      {{ $pages = .Pages.ByTitle.Reverse }}
    {{ else }}
      {{ $pages = .Pages.ByTitle }}
    {{ end }}
  {{ else if eq $sortBy "publishDate" }}
    {{ if eq $sortOrder "desc" }}
      {{ $pages = .Pages.ByPublishDate.Reverse }}
    {{ else }}
      {{ $pages = .Pages.ByPublishDate }}
    {{ end }}
  {{ else if eq $sortBy "lastmod" }}
    {{ if eq $sortOrder "desc" }}
      {{ $pages = .Pages.ByLastmod.Reverse }}
    {{ else }}
      {{ $pages = .Pages.ByLastmod }}
    {{ end }}
  {{ else if eq $sortBy "weight" }}
    {{ if eq $sortOrder "desc" }}
      {{ $pages = .Pages.ByWeight.Reverse }}
    {{ else }}
      {{ $pages = .Pages.ByWeight }}
    {{ end }}
  {{ else }}
    {{/* Default to title sorting */}}
    {{ $pages = .Pages.ByTitle }}
  {{ end }}

  {{ $paginator := .Paginate $pages 60 }}

  <div class="wrapper grid grid-cols-1 gap-x-8 gap-y-12 md:grid-cols-2 xl:grid-cols-3">
    {{ range $paginator.Pages }}
      <div>
        {{ partial "components/cards/post_card_with_image.html" (dict "page" . "cardHeight" 540) }}
      </div>
    {{ end }}
  </div>
  <!-- Pagination -->
  {{ if gt $paginator.TotalPages 1 }}
    {{partial "components/pagination/pagination.html" $paginator }}
  {{ end }}
{{ end }}

{{ if .Content }}
  {{ partial "sections/content/centered.html" (dict 
      "content" (partial "utils/linkbuilding" (dict "content" .Content "page" .) | safeHTML)
      "bgColor" "bg-gray-50"
      "page" .
  ) }}
{{ end }}

{{ partial "cta.html" . }}

{{ end }}

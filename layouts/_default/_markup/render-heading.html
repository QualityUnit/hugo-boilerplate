{{- /*
  Heading Render Hook with Mini Banner Injection
  ==============================================

  How to enable mini banners for a post type section:
  ----------------------------------------------------

  1. Open the _index.md file for your section, for example:
     content/en/blog/_index.md
     content/en/academy/_index.md
     content/en/glossary/_index.md

  2. Add this BEFORE the closing +++ :

     [cascade]
       miniBannerEnabled = true
       miniBannerCtaPosition = 3
       # Optional: disable newsletter banner (enabled by default)
       # miniBannerNewsletterEnabled = false
       miniBannerNewsletterPosition = 5

  Full example with custom texts and URLs:
  +++
  title = "Blog"
  description = "..."

  [cascade]
    miniBannerEnabled = true
    miniBannerCtaPosition = 3
    miniBannerNewsletterPosition = 5
    # Optional: disable newsletter banner (enabled by default)
    # miniBannerNewsletterEnabled = false
    # Optional CTA banner customization (falls back to i18n/defaults if not set)
    miniBannerCtaHeading = "Launch your affiliate program today"
    miniBannerCtaDescription = "Set up advanced tracking in minutes. No credit card required."
    miniBannerCtaPrimaryText = "Get Demo"
    miniBannerCtaPrimaryUrl = "/demo/"
    miniBannerCtaSecondaryText = "Free Trial"
    miniBannerCtaSecondaryUrl = "/trial/"
    # Optional Newsletter banner customization
    miniBannerNewsletterHeading = "Join our newsletter"
    miniBannerNewsletterDescription = "Be the first to know about new features and product updates."
    miniBannerNewsletterPlaceholder = "Email address"
    miniBannerNewsletterButtonText = "Subscribe"

  +++

  This will enable banners for ALL articles in that section.
  Repeat for all languages: content/sk/blog/_index.md, content/de/blog/_index.md, etc.

  How positions work:
  -------------------
  ctaPosition = 3           # CTA banner appears BEFORE the 3rd H2 heading
  newsletterPosition = 5    # Newsletter banner appears BEFORE the 5th H2 heading

  Example article structure:
    ## First H2              ← H2 count = 1
    Content...
    ## Second H2             ← H2 count = 2
    Content...
    [CTA BANNER INSERTED HERE]     ← Before 3rd H2 (ctaPosition = 3)
    ## Third H2              ← H2 count = 3
    Content...
    ## Fourth H2             ← H2 count = 4
    Content...
    [NEWSLETTER BANNER INSERTED HERE]  ← Before 5th H2 (newsletterPosition = 5)
    ## Fifth H2              ← H2 count = 5
    Content...

  Note: If article has fewer H2 headings than configured positions, banners won't appear.
        For example, if article has only 4 H2s, newsletter banner (position 5) won't show.

  Per-article disable:
  --------------------
  Add to article's front matter:
    miniBannerDisabled = true
*/ -}}

{{- $level := .Level -}}
{{- $text := .Text -}}
{{- $anchor := .Anchor -}}

{{- if eq $level 2 -}}
  {{- /* Check if enabled via page params (from cascade) */ -}}
  {{- $enabled := .Page.Params.miniBannerEnabled | default false -}}

  {{- if $enabled -}}
    {{- /* Check if disabled for this specific page */ -}}
    {{- $disabled := .Page.Params.miniBannerDisabled | default false -}}

    {{- if not $disabled -}}
      {{- $ctaPos := .Page.Params.miniBannerCtaPosition | default 3 -}}
      {{- $newsletterEnabled := .Page.Params.miniBannerNewsletterEnabled | default true -}}
      {{- $newsletterPos := .Page.Params.miniBannerNewsletterPosition | default 5 -}}

      {{- /* Count H2 headings */ -}}
      {{- $h2Count := .Page.Scratch.Get "h2Count" | default 0 -}}
      {{- $h2Count = add $h2Count 1 -}}
      {{- .Page.Scratch.Set "h2Count" $h2Count -}}

      {{- /* Insert CTA banner */ -}}
      {{- if eq $h2Count $ctaPos -}}
        {{- partial "sections/banners/mini-banner-cta.html" (dict
          "heading" .Page.Params.miniBannerCtaHeading
          "description" .Page.Params.miniBannerCtaDescription
          "primaryText" .Page.Params.miniBannerCtaPrimaryText
          "primaryUrl" .Page.Params.miniBannerCtaPrimaryUrl
          "secondaryText" .Page.Params.miniBannerCtaSecondaryText
          "secondaryUrl" .Page.Params.miniBannerCtaSecondaryUrl
        ) -}}
      {{- end -}}

      {{- /* Insert Newsletter banner (only if explicitly enabled) */ -}}
      {{- if and $newsletterEnabled (eq $h2Count $newsletterPos) -}}
        {{- partial "sections/banners/mini-banner-newsletter.html" (dict
          "heading" .Page.Params.miniBannerNewsletterHeading
          "description" .Page.Params.miniBannerNewsletterDescription
          "placeholder" .Page.Params.miniBannerNewsletterPlaceholder
          "buttonText" .Page.Params.miniBannerNewsletterButtonText
          "Site" .Page.Site
        ) -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- /* Render the heading */ -}}
<h{{ $level }} id="{{ $anchor }}">
  {{- $text | safeHTML -}}
</h{{ $level }}>

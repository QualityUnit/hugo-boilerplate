{{ $params := .Page.Params }}
{{ $taglineComparison := .Get "taglineComparison" | default $params.taglineComparison | default (.Get 0) | default nil }}
{{ $headingComparison := .Get "headingComparison" | default $params.headingComparison | default (.Get 1) | default (i18n "pricing_comparison_title") }}
{{ $descriptionComparison := .Get "descriptionComparison" | default $params.descriptionComparison | default (.Get 2) | default (i18n "pricing_comparison_description") }}
{{ $backgroundColorComparison := .Get "backgroundColorComparison" | default $params.backgroundColor | default (.Get 3) | default "white" }}
{{ $taglineColorComparison := .Get "taglineColorComparison" | default $params.taglineColorComparison | default (.Get 4) | default "indigo-600" }}
{{ $headingColorComparison := .Get "headingColorComparison" | default $params.headingColorComparison | default (.Get 5) | default "gray-900" }}
{{ $descriptionColorComparison := .Get "descriptionColorComparison" | default $params.descriptionColorComparison | default (.Get 6) | default "gray-600" }}
{{ $toggleTextColor := .Get "toggleTextColor" | default $params.toggleTextColor | default "gray-500" }}
{{ $toggleActiveColor := .Get "toggleActiveColor" | default $params.toggleActiveColor | default "white" }}
{{ $toggleActiveBgColor := .Get "toggleActiveBgColor" | default $params.toggleActiveBgColor | default "primary" }}
{{ $toggleBorderColor := .Get "toggleBorderColor" | default $params.toggleBorderColor | default "primary" }}
{{ $togglePrice := .Get "togglePrice" | default $params.togglePrice | default true }}

{{/* Try to use centralized data first, fallback to page params */}}
{{ $tiersComparison := slice }}
{{ $featureCategories := slice }}
{{ $pricingData := .Site.Data.pricing }}
{{ if and $pricingData $pricingData.tiersComparison $pricingData.featureCategories }}
  {{/* Use centralized data */}}
  {{ $tiersComparison = $pricingData.tiersComparison }}
  {{ $featureCategories = $pricingData.featureCategories }}
{{ else }}
  {{/* Fallback to page parameters for backward compatibility */}}
  {{ $tiersComparison = .Get "tiersComparison" | default $params.tiersComparison | default slice }}
  {{ $featureCategories = .Get "featureCategories" | default $params.featureCategories | default slice }}
{{ end }}

{{ partial "sections/pricing/with_comparison_table.html" (dict
  "taglineComparison" $taglineComparison
  "headingComparison" $headingComparison
  "descriptionComparison" $descriptionComparison
  "backgroundColorComparison" $backgroundColorComparison
  "taglineColorComparison" $taglineColorComparison
  "headingColorComparison" $headingColorComparison
  "descriptionColorComparison" $descriptionColorComparison
  "tiersComparison" $tiersComparison
  "featureCategories" $featureCategories
  "toggleTextColor" $toggleTextColor
  "toggleActiveColor" $toggleActiveColor
  "toggleActiveBgColor" $toggleActiveBgColor
  "toggleBorderColor" $toggleBorderColor
  "togglePrice" $togglePrice
) }}

{{/*
  CENTRALIZED PRICING SYSTEM - Comparison Table Shortcode
  ======================================================
  
  This shortcode displays a comprehensive pricing comparison table using centralized 
  data from data/pricing.yaml with full multilingual support via i18n translations.
  
  FEATURES:
  - Auto-loads pricing data from data/pricing.yaml (single source of truth)
  - Detailed feature comparison matrix with 9 categories
  - Multilingual support with i18n keys for all text content
  - Monthly/annual pricing toggle
  - Responsive design with mobile optimization
  - Backward compatibility with page-level parameters
  
  USAGE:
  {{< pricing-with-comparison-table >}}                    # Uses centralized data
  {{< pricing-with-comparison-table togglePrice=false >}}  # Disable price toggle
  
  CENTRALIZED DATA STRUCTURE (data/pricing.yaml):
  tiersComparison:
    - name: "Pro"                                   # Internal identifier
      displayName: "pricing_tier_pro_name"         # i18n key for display
      monthlyPrice: "$139"
      annualPrice: "$129" 
      interval: "pricing_interval_monthly_annual"   # i18n key
      emphasized: false
      cta:
        text: "pricing_cta_try_free"                # i18n key
        url: "https://www.postaffiliatepro.com/trial/"
        
  featureCategories:
    - name: "pricing_category_tracking"             # i18n key
      features:
        - name: "pricing_feature_tracking_requests" # i18n key
          tooltip: "pricing_tooltip_tracking_requests" # i18n key
          tiersComparison:
            Pro: "1 000 000/month"
            Ultimate: "6 000 000/month"
            Network: "20 000 000/month"
  
  TRANSLATIONS (i18n/en.yaml):
  pricing_tier_pro_name: "Pro"
  pricing_interval_monthly_annual: "/month billed annually"
  pricing_category_tracking: "Tracking"
  pricing_feature_tracking_requests: "Tracking requests"
  pricing_tooltip_tracking_requests: "Number of tracking requests per month"
  pricing_cta_try_free: "Try for free"
  
  PARAMETERS:
  - taglineComparison: Text above heading (optional)
  - headingComparison: Main heading (default: i18n "pricing_comparison_title")
  - descriptionComparison: Description (default: i18n "pricing_comparison_description")
  - backgroundColorComparison: Section background (default: "white")
  - togglePrice: Enable monthly/annual toggle (default: true)
  - toggleTextColor: Inactive toggle text color (default: "gray-500")
  - toggleActiveColor: Active toggle text color (default: "white") 
  - toggleActiveBgColor: Active toggle background (default: "primary")
  - toggleBorderColor: Toggle border color (default: "primary")
  
  FEATURE CATEGORIES (9 total):
  1. Price - Monthly/annual pricing
  2. Support - Lifetime support options
  3. Tracking - Tracking requests and methods
  4. Management - Affiliate management tools
  5. Commissions - Commission types and models
  6. Marketing - Marketing tools and banners
  7. Reporting - Analytics and reporting features
  8. Integrations - Third-party integrations
  9. Security - Security and compliance features
  
  BENEFITS:
  ✅ Single point of price updates across 250K+ pages
  ✅ Comprehensive feature comparison with tooltips
  ✅ Multilingual support with consistent pricing
  ✅ Interactive monthly/annual pricing toggle
  ✅ Responsive mobile-first design
  ✅ Backward compatibility with existing implementations
*/}}
